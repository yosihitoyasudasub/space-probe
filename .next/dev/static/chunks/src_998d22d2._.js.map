{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/my_projects/space-probe-game-next/src/lib/physics.ts"],"sourcesContent":["// This physics module avoids direct dependence on three.js types so it can be\r\n// unit-tested and reused. Positions/velocities are plain number tuples [x,y,z].\r\n\r\nexport type Vec3 = [number, number, number];\r\n\r\nexport type Body = {\r\n    id: string;\r\n    mass: number;\r\n    position: Vec3;\r\n    velocity: Vec3;\r\n    radius?: number; // visual / encounter radius\r\n    isProbe?: boolean;\r\n    isStatic?: boolean; // if true, body should not be moved by simulation (e.g., sun)\r\n    _lastEncounterAt?: number;\r\n};\r\n\r\nexport type StepResult = {\r\n    bodies: Body[];\r\n    events: { swingBys: Array<{ probeId: string; bodyId: string; deltaV: number; time: number }> };\r\n};\r\n\r\nfunction vecClone(v: Vec3): Vec3 {\r\n    return [v[0], v[1], v[2]];\r\n}\r\n\r\nfunction vecAdd(a: Vec3, b: Vec3): Vec3 {\r\n    return [a[0] + b[0], a[1] + b[1], a[2] + b[2]];\r\n}\r\n\r\nfunction vecSub(a: Vec3, b: Vec3): Vec3 {\r\n    return [a[0] - b[0], a[1] - b[1], a[2] - b[2]];\r\n}\r\n\r\nfunction vecScale(a: Vec3, s: number): Vec3 {\r\n    return [a[0] * s, a[1] * s, a[2] * s];\r\n}\r\n\r\nfunction vecLenSq(a: Vec3): number {\r\n    return a[0] * a[0] + a[1] * a[1] + a[2] * a[2];\r\n}\r\n\r\nfunction vecLen(a: Vec3): number {\r\n    return Math.sqrt(vecLenSq(a));\r\n}\r\n\r\nfunction vecNormalize(a: Vec3): Vec3 {\r\n    const l = vecLen(a) || 1e-12;\r\n    return [a[0] / l, a[1] / l, a[2] / l];\r\n}\r\n\r\nexport function cloneBodies(bodies: Body[]) {\r\n    return bodies.map((b) => ({ ...b, position: vecClone(b.position), velocity: vecClone(b.velocity), _lastEncounterAt: b._lastEncounterAt || 0, isStatic: b.isStatic }));\r\n}\r\n\r\n// Leapfrog / velocity-Verlet style integrator for N-body\r\nexport type SwingByOptions = {\r\n    encounterMultiplier?: number; // multiplies body.radius to form encounter distance\r\n    deltaVThreshold?: number; // minimum positive delta-v to count as swing-by\r\n    minGap?: number; // seconds before same body can trigger again\r\n};\r\n\r\nexport function stepBodies(origBodies: Body[], dt: number, G = 1.0, simTime = 0, softening = 0.1, opts?: SwingByOptions): StepResult {\r\n    const bodies = cloneBodies(origBodies);\r\n    const n = bodies.length;\r\n\r\n    // compute accelerations at current positions\r\n    const accs: Vec3[] = new Array(n).fill(0).map(() => [0, 0, 0]);\r\n\r\n    const computeAcc = (i: number, positions: Vec3[]) => {\r\n        let ax = 0,\r\n            ay = 0,\r\n            az = 0;\r\n        const pi = positions[i];\r\n        if (bodies[i].isStatic) return [0, 0, 0] as Vec3;\r\n        for (let j = 0; j < n; j++) {\r\n            if (i === j) continue;\r\n            const pj = positions[j];\r\n            const rx = pj[0] - pi[0];\r\n            const ry = pj[1] - pi[1];\r\n            const rz = pj[2] - pi[2];\r\n            const dist2 = rx * rx + ry * ry + rz * rz + softening * softening;\r\n            const invDist = 1.0 / Math.sqrt(dist2);\r\n            const invDist3 = invDist / dist2; // 1/r^3\r\n            const s = G * bodies[j].mass * invDist3;\r\n            ax += rx * s;\r\n            ay += ry * s;\r\n            az += rz * s;\r\n        }\r\n        return [ax, ay, az] as Vec3;\r\n    };\r\n\r\n    const positions = bodies.map((b) => vecClone(b.position));\r\n    for (let i = 0; i < n; i++) accs[i] = computeAcc(i, positions);\r\n\r\n    // half-step velocity\r\n    const vHalf: Vec3[] = new Array(n).fill(0).map(() => [0, 0, 0]);\r\n    for (let i = 0; i < n; i++) {\r\n        if (bodies[i].isStatic) {\r\n            vHalf[i] = vecClone(bodies[i].velocity);\r\n            continue;\r\n        }\r\n        vHalf[i] = vecAdd(bodies[i].velocity, vecScale(accs[i], dt * 0.5));\r\n        // full-step position\r\n        bodies[i].position = vecAdd(bodies[i].position, vecScale(vHalf[i], dt));\r\n    }\r\n\r\n    // accelerations at new positions\r\n    const newPositions = bodies.map((b) => vecClone(b.position));\r\n    const accsNew: Vec3[] = new Array(n).fill(0).map(() => [0, 0, 0]);\r\n    for (let i = 0; i < n; i++) accsNew[i] = computeAcc(i, newPositions);\r\n\r\n    // finish velocity\r\n    for (let i = 0; i < n; i++) {\r\n        if (bodies[i].isStatic) continue;\r\n        bodies[i].velocity = vecAdd(vHalf[i], vecScale(accsNew[i], dt * 0.5));\r\n    }\r\n\r\n    const events: StepResult['events'] = { swingBys: [] };\r\n\r\n    // swing-by detection: probe close pass and positive delta speed\r\n    for (let i = 0; i < n; i++) {\r\n        if (!bodies[i].isProbe) continue;\r\n        const probe = bodies[i];\r\n        const speedBefore = vecLen(vHalf[i]);\r\n        const speedAfter = vecLen(probe.velocity);\r\n        for (let j = 0; j < n; j++) {\r\n            if (i === j) continue;\r\n            const other = bodies[j];\r\n            if (other.mass < 1e-6) continue;\r\n            const rx = probe.position[0] - other.position[0];\r\n            const ry = probe.position[1] - other.position[1];\r\n            const rz = probe.position[2] - other.position[2];\r\n            const dist = Math.sqrt(rx * rx + ry * ry + rz * rz);\r\n            const encounterMultiplier = opts?.encounterMultiplier ?? 2.5;\r\n            const deltaVThreshold = opts?.deltaVThreshold ?? 0.05;\r\n            const gap = opts?.minGap ?? 0.5;\r\n            const encounterRadius = Math.max((other.radius || 1) * encounterMultiplier, 1.0);\r\n            const lastAt = other._lastEncounterAt || 0;\r\n            if (dist <= encounterRadius && simTime - lastAt > gap) {\r\n                const deltaV = speedAfter - speedBefore;\r\n                if (deltaV > deltaVThreshold) {\r\n                    events.swingBys.push({ probeId: probe.id, bodyId: other.id, deltaV, time: simTime });\r\n                    other._lastEncounterAt = simTime;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return { bodies, events };\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 178, "column": 0}, "map": {"version":3,"sources":["file:///D:/my_projects/space-probe-game-next/src/lib/threeSetup.ts"],"sourcesContent":["import * as THREE from 'three';\r\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';\r\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader';\r\nimport { Body, cloneBodies, stepBodies } from './physics';\r\n\r\n// ====================================================================\r\n// Physics Scale Factors and Units\r\n// ====================================================================\r\n// This simulation uses a scaled unit system for game playability:\r\n// - Mass: Earth mass = 1.0, Sun mass = 333,000 (realistic ratio)\r\n// - Distance: 1 AU = 100 scene units\r\n// - Time: Accelerated by factor of ~1,000,000 (1 real second ≈ 11.6 simulation days)\r\n// - This gives Earth orbital period of ~30 seconds (vs 365 days in reality)\r\n// ====================================================================\r\n\r\nexport const PHYSICS_SCALE = {\r\n    // Mass scale: Earth mass = 1.0\r\n    EARTH_MASS: 1.0,\r\n    SUN_MASS: 333000,  // Realistic Sun/Earth mass ratio\r\n\r\n    // Distance scale: 1 AU = 100 scene units\r\n    AU: 100,\r\n\r\n    // Time scale: ~1 million times faster than reality\r\n    // (Earth completes orbit in ~30 seconds instead of 365 days)\r\n    TIME_SCALE: 1e6,\r\n\r\n    // Gravity constant adjusted for our unit system\r\n    // This value gives realistic orbital mechanics with scaled time\r\n    G: 0.133,\r\n\r\n    // Velocity conversion: scene units/sec to km/s\r\n    // Based on Earth orbital velocity: ~21 scene units/sec = 30 km/s (real)\r\n    VELOCITY_TO_KM_PER_SEC: 1.43,  // multiply scene velocity by this to get km/s\r\n\r\n    // Fuel consumption rate: % consumed per unit delta-v\r\n    // With dvScale = 0.02, single direction thrust consumes 0.02% per frame\r\n    // Total fuel = 100%, allows ~5000 frames (~83 seconds at 60fps) of continuous thrust\r\n    FUEL_CONSUMPTION_RATE: 1.0,\r\n};\r\n\r\n// Legacy constant for backward compatibility\r\nexport const DEFAULT_G = PHYSICS_SCALE.G;\r\n\r\nexport type ProbeState = {\r\n    position: THREE.Vector3;\r\n    velocity: THREE.Vector3; // vector velocity in scene units/sec\r\n    distance: number; // accumulated path length\r\n    fuel: number; // percent\r\n    slingshots: number;\r\n    status: string;\r\n};\r\n\r\n// ====================================================================\r\n// Probe Model Creation Functions\r\n// ====================================================================\r\n\r\n/**\r\n * Create a Voyager-style probe using Three.js primitives\r\n */\r\nfunction createVoyagerProbe(): THREE.Group {\r\n    const probe = new THREE.Group();\r\n\r\n    // Main body (10-sided cylinder approximation)\r\n    const bodyGeom = new THREE.CylinderGeometry(0.5, 0.5, 0.4, 10);\r\n    const bodyMat = new THREE.MeshStandardMaterial({ color: 0xcccccc, metalness: 0.6, roughness: 0.4 });\r\n    const body = new THREE.Mesh(bodyGeom, bodyMat);\r\n    body.rotation.x = Math.PI / 2;\r\n    probe.add(body);\r\n\r\n    // Parabolic antenna (dish)\r\n    const dishGeom = new THREE.CylinderGeometry(1.2, 1.2, 0.1, 32);\r\n    const dishMat = new THREE.MeshStandardMaterial({ color: 0xeeeeee, metalness: 0.8, roughness: 0.2 });\r\n    const dish = new THREE.Mesh(dishGeom, dishMat);\r\n    dish.rotation.x = Math.PI / 2;\r\n    dish.position.set(0, 0, 0.3);\r\n    probe.add(dish);\r\n\r\n    // Antenna feed (center of dish)\r\n    const feedGeom = new THREE.ConeGeometry(0.15, 0.4, 8);\r\n    const feedMat = new THREE.MeshStandardMaterial({ color: 0x888888 });\r\n    const feed = new THREE.Mesh(feedGeom, feedMat);\r\n    feed.rotation.x = Math.PI / 2;\r\n    feed.position.set(0, 0, 0.5);\r\n    probe.add(feed);\r\n\r\n    // RTG boom (Radioisotope Thermoelectric Generator)\r\n    const rtgBoomGeom = new THREE.CylinderGeometry(0.05, 0.05, 3, 8);\r\n    const rtgBoomMat = new THREE.MeshStandardMaterial({ color: 0x666666 });\r\n    const rtgBoom = new THREE.Mesh(rtgBoomGeom, rtgBoomMat);\r\n    rtgBoom.rotation.z = Math.PI / 2;\r\n    rtgBoom.position.set(-1.5, -0.3, 0);\r\n    probe.add(rtgBoom);\r\n\r\n    // RTG power source (box at end of boom)\r\n    const rtgGeom = new THREE.BoxGeometry(0.2, 0.2, 0.3);\r\n    const rtgMat = new THREE.MeshStandardMaterial({ color: 0x444444, emissive: 0x330000 });\r\n    const rtg = new THREE.Mesh(rtgGeom, rtgMat);\r\n    rtg.position.set(-3, -0.3, 0);\r\n    probe.add(rtg);\r\n\r\n    // Magnetometer boom\r\n    const magBoomGeom = new THREE.CylinderGeometry(0.03, 0.03, 4, 6);\r\n    const magBoomMat = new THREE.MeshStandardMaterial({ color: 0x888888 });\r\n    const magBoom = new THREE.Mesh(magBoomGeom, magBoomMat);\r\n    magBoom.rotation.z = Math.PI / 2;\r\n    magBoom.position.set(2, 0.2, 0);\r\n    probe.add(magBoom);\r\n\r\n    // Magnetometer sensor\r\n    const magSensorGeom = new THREE.BoxGeometry(0.15, 0.15, 0.15);\r\n    const magSensorMat = new THREE.MeshStandardMaterial({ color: 0xffaa00 });\r\n    const magSensor = new THREE.Mesh(magSensorGeom, magSensorMat);\r\n    magSensor.position.set(4, 0.2, 0);\r\n    probe.add(magSensor);\r\n\r\n    // Science instruments platform\r\n    const instrumentsGeom = new THREE.BoxGeometry(0.4, 0.3, 0.3);\r\n    const instrumentsMat = new THREE.MeshStandardMaterial({ color: 0x999999 });\r\n    const instruments = new THREE.Mesh(instrumentsGeom, instrumentsMat);\r\n    instruments.position.set(0, 0.35, 0);\r\n    probe.add(instruments);\r\n\r\n    // Scale up for visibility\r\n    probe.scale.set(3, 3, 3);\r\n\r\n    return probe;\r\n}\r\n\r\n/**\r\n * Load a GLB model and return it as a Group\r\n * @param modelPath Path to the GLB file (relative to public folder)\r\n * @param onLoad Callback when model is loaded successfully\r\n * @param onError Callback when loading fails\r\n */\r\nfunction loadGLBProbe(\r\n    modelPath: string,\r\n    onLoad: (model: THREE.Group) => void,\r\n    onError: (error: any) => void\r\n): void {\r\n    const loader = new GLTFLoader();\r\n\r\n    loader.load(\r\n        modelPath,\r\n        (gltf) => {\r\n            const model = gltf.scene;\r\n\r\n            // Adjust model orientation and scale as needed\r\n            // (These values may need adjustment based on your specific GLB file)\r\n            model.scale.set(0.05, 0.05, 0.05);\r\n            model.rotation.y = Math.PI; // Rotate 180 degrees if needed\r\n\r\n            // Brighten all materials in the model\r\n            model.traverse((child: any) => {\r\n                if (child.isMesh && child.material) {\r\n                    const material = child.material;\r\n\r\n                    // Handle both single material and array of materials\r\n                    const materials = Array.isArray(material) ? material : [material];\r\n\r\n                    materials.forEach((mat: any) => {\r\n                        // Increase color brightness\r\n                        if (mat.color) {\r\n                            mat.color.multiplyScalar(1.1); // Make 2.5x brighter\r\n                        }\r\n\r\n                        // Adjust other properties for better visibility\r\n                        if (mat.metalness !== undefined) {\r\n                            mat.metalness = Math.min(mat.metalness * 1.2, 1.0);\r\n                        }\r\n                        if (mat.roughness !== undefined) {\r\n                            mat.roughness = Math.max(mat.roughness * 0.7, 0.3);\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n\r\n            console.log('GLB model loaded successfully:', modelPath);\r\n            onLoad(model);\r\n        },\r\n        (progress) => {\r\n            // Loading progress (optional)\r\n            const percent = (progress.loaded / progress.total) * 100;\r\n            console.log(`Loading model: ${percent.toFixed(0)}%`);\r\n        },\r\n        (error) => {\r\n            console.error('Error loading GLB model:', error);\r\n            onError(error);\r\n        }\r\n    );\r\n}\r\n\r\nexport function initThreeJS(canvas: HTMLCanvasElement, options?: { probeSpeedMult?: number; G?: number; starMass?: number; gravityGridEnabled?: boolean }) {\r\n    const scene = new THREE.Scene();\r\n    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 50000);\r\n    camera.position.set(0, 400, 2200);\r\n\r\n    const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });\r\n    renderer.setSize(window.innerWidth, window.innerHeight);\r\n    renderer.setPixelRatio(Math.min(window.devicePixelRatio || 1, 2));\r\n\r\n    const ambient = new THREE.AmbientLight(0xffffff, 0.6);\r\n    scene.add(ambient);\r\n    const directional = new THREE.DirectionalLight(0xffffff, 0.8);\r\n    directional.position.set(5, 10, 7.5);\r\n    scene.add(directional);\r\n\r\n    // Simple grid for reference (large enough to show outer planets)\r\n    const grid = new THREE.GridHelper(7000, 1000, 0x444444, 0x222222);\r\n    scene.add(grid);\r\n\r\n    // ====================================================================\r\n    // Gravity Well Grid (curved based on gravitational potential)\r\n    // ====================================================================\r\n    const gridSize = 7000;\r\n    const gridDivisions = 200; // High resolution for smooth curvature\r\n    const gravityWellGeometry = new THREE.PlaneGeometry(gridSize, gridSize, gridDivisions, gridDivisions);\r\n    gravityWellGeometry.rotateX(-Math.PI / 2); // Rotate to horizontal (XZ plane)\r\n\r\n    // Wireframe material for the gravity well\r\n    const gravityWellMaterial = new THREE.MeshBasicMaterial({\r\n        color: 0xd3d3d3,\r\n        wireframe: true,\r\n        transparent: true,\r\n        opacity: 0.05\r\n    });\r\n\r\n    const gravityWellMesh = new THREE.Mesh(gravityWellGeometry, gravityWellMaterial);\r\n    gravityWellMesh.visible = options?.gravityGridEnabled ?? false;\r\n    scene.add(gravityWellMesh);\r\n\r\n    // Store original positions for reset\r\n    const originalPositions = new Float32Array(gravityWellGeometry.attributes.position.array);\r\n\r\n    // Create a list of bodies: central star, planets, probe\r\n    const bodies: Body[] = [];\r\n    const planetMeshes: { id: string; mesh: THREE.Mesh }[] = [];\r\n\r\n    // central star at origin (can be overridden via options)\r\n    const starMass = options?.starMass ?? PHYSICS_SCALE.SUN_MASS;\r\n    const starGeom = new THREE.SphereGeometry(5, 24, 24);\r\n    const starMat = new THREE.MeshStandardMaterial({ color: 0xffee88, emissive: 0x220000 });\r\n    const starMesh = new THREE.Mesh(starGeom, starMat);\r\n    starMesh.position.set(0, 0, 0);\r\n    scene.add(starMesh);\r\n    // allow the star to move under gravity (we'll initialize COM-zero velocities below)\r\n    bodies.push({ id: 'star', mass: starMass, position: [0, 0, 0], velocity: [0, 0, 0], radius: 5, isProbe: false });\r\n\r\n    // Solar system-like planets (units: 1 AU = 100 scene units)\r\n    const AU = PHYSICS_SCALE.AU;\r\n    const solarDefs = [\r\n        { id: 'Mercury', rAU: 0.39, radius: 3, color: 0xaaaaaa, phase: 0, mass: 0.055 },\r\n        { id: 'Venus',   rAU: 0.72, radius: 5, color: 0xffddaa, phase: 0.5, mass: 0.815 },\r\n        { id: 'Earth',   rAU: 1.00, radius: 5.5, color: 0x3366ff, phase: 1.0, mass: 1.0 },\r\n        { id: 'Mars',    rAU: 1.52, radius: 4, color: 0xff6633, phase: 1.6, mass: 0.107 },\r\n        { id: 'Jupiter', rAU: 5.20, radius: 14, color: 0xffcc77, phase: 2.2, mass: 317.8 },\r\n        { id: 'Saturn',  rAU: 9.58, radius: 12, color: 0xffee88, phase: 3.0, mass: 95.16 },\r\n        { id: 'Uranus',  rAU:19.20, radius: 9, color: 0x88ccff, phase: 4.0, mass: 14.5 },\r\n        { id: 'Neptune', rAU:30.05, radius: 9, color: 0x3366aa, phase: 5.0, mass: 17.1 },\r\n    ];\r\n\r\n    const starMassScaled = starMass; // use starMass as mass scale\r\n    for (const pd of solarDefs) {\r\n        const pdR = pd.rAU * AU;\r\n        const geom = new THREE.SphereGeometry(pd.radius, 16, 16);\r\n        const mat = new THREE.MeshStandardMaterial({ color: pd.color });\r\n        const mesh = new THREE.Mesh(geom, mat);\r\n        const x = Math.sin(pd.phase) * pdR;\r\n        const z = Math.cos(pd.phase) * pdR;\r\n        mesh.position.set(x, 0, z);\r\n        scene.add(mesh);\r\n        planetMeshes.push({ id: pd.id, mesh });\r\n    const gVal = options?.G ?? DEFAULT_G;\r\n    const v = Math.sqrt((gVal * starMassScaled) / pdR);\r\n        const vx = v * Math.cos(pd.phase);\r\n        const vz = -v * Math.sin(pd.phase);\r\n        bodies.push({ id: pd.id, mass: pd.mass, position: [x, 0, z], velocity: [vx, 0, vz], radius: pd.radius });\r\n    }\r\n\r\n    // probe initial (starts at 1.0 AU - Earth orbit distance)\r\n    // Create Voyager-style probe (will be replaced by GLB model if loading succeeds)\r\n    let probe = createVoyagerProbe();\r\n\r\n    const probeR = 100;  // 1.0 AU (same as Earth orbit)\r\n    probe.position.set(0, 0, probeR);\r\n    scene.add(probe);\r\n\r\n    // Attempt to load GLB model from public/models/ directory\r\n    // If loading fails, fallback to the Voyager probe created above\r\n    loadGLBProbe(\r\n        '/models/space_fighter.glb',\r\n        (loadedModel) => {\r\n            // Success: replace the probe with the loaded GLB model\r\n            console.log('GLB model loaded, replacing probe');\r\n\r\n            // Copy position from current probe to loaded model\r\n            loadedModel.position.copy(probe.position);\r\n\r\n            // Remove old probe from scene\r\n            scene.remove(probe);\r\n\r\n            // Add loaded model to scene\r\n            scene.add(loadedModel);\r\n\r\n            // Update probe reference to point to loaded model\r\n            probe = loadedModel;\r\n\r\n            console.log('Probe replaced with GLB model successfully');\r\n        },\r\n        (error) => {\r\n            // Error: keep using the Voyager probe as fallback\r\n            console.log('Failed to load GLB model, using Voyager probe as fallback');\r\n            console.error('GLB loading error:', error);\r\n        }\r\n    );\r\n\r\n    const gVal = options?.G ?? DEFAULT_G;\r\n    const probeMult = options?.probeSpeedMult ?? 1.05;  // Realistic escape velocity (5% above circular)\r\n    const vCircular = Math.sqrt((gVal * starMass) / probeR);\r\n    const probeBody: Body = { id: 'probe', mass: 1, position: [0, 0, probeR], velocity: [vCircular * probeMult, 0, 0], radius: 0.6, isProbe: true };\r\n    bodies.push(probeBody);\r\n\r\n    // --- CENTER-OF-MASS (COM) velocity zeroing ---\r\n    // After creating all bodies, compute total momentum and apply a uniform\r\n    // velocity offset so total momentum is zero. This keeps the system's\r\n    // center-of-mass stationary while allowing the star to move.\r\n    (function zeroCOM() {\r\n        let totalPx = 0, totalPy = 0, totalPz = 0;\r\n        let totalMass = 0;\r\n        for (const b of bodies) {\r\n            totalPx += b.mass * b.velocity[0];\r\n            totalPy += b.mass * b.velocity[1];\r\n            totalPz += b.mass * b.velocity[2];\r\n            totalMass += b.mass;\r\n        }\r\n        if (totalMass > 0) {\r\n            const vx = totalPx / totalMass;\r\n            const vy = totalPy / totalMass;\r\n            const vz = totalPz / totalMass;\r\n            // subtract COM velocity from each body so net momentum becomes zero\r\n            for (const b of bodies) {\r\n                b.velocity[0] -= vx;\r\n                b.velocity[1] -= vy;\r\n                b.velocity[2] -= vz;\r\n            }\r\n            console.log('COM-zero velocity applied, offset:', vx.toFixed(6), vy.toFixed(6), vz.toFixed(6));\r\n        }\r\n    })();\r\n\r\n    // (COM position zeroing will be performed once after state is created)\r\n\r\n    // OrbitControls for interactive camera\r\n    const controls = new OrbitControls(camera, renderer.domElement);\r\n    controls.enableDamping = true;\r\n    controls.dampingFactor = 0.05;\r\n    controls.enablePan = true;\r\n    controls.update();\r\n\r\n    // ====================================================================\r\n    // Star Field for Speed Sensation\r\n    // ====================================================================\r\n    // Create background stars with color variation for visual depth\r\n    function createStarField() {\r\n        const starCount = 8000;\r\n        const starGeometry = new THREE.BufferGeometry();\r\n        const starPositions = new Float32Array(starCount * 3);\r\n        const starColors = new Float32Array(starCount * 3);\r\n\r\n        for (let i = 0; i < starCount; i++) {\r\n            // Position: random spherical distribution\r\n            const radius = 5000 + Math.random() * 10000; // 5000-15000 range\r\n            const theta = Math.random() * Math.PI * 2;   // 0-2π\r\n            const phi = Math.acos(2 * Math.random() - 1); // 0-π (uniform sphere)\r\n\r\n            starPositions[i * 3] = radius * Math.sin(phi) * Math.cos(theta);\r\n            starPositions[i * 3 + 1] = radius * Math.sin(phi) * Math.sin(theta);\r\n            starPositions[i * 3 + 2] = radius * Math.cos(phi);\r\n\r\n            // Color: mostly white, occasionally bluish or yellowish\r\n            const colorChoice = Math.random();\r\n            if (colorChoice < 0.7) {\r\n                // White\r\n                starColors[i * 3] = 1;\r\n                starColors[i * 3 + 1] = 1;\r\n                starColors[i * 3 + 2] = 1;\r\n            } else if (colorChoice < 0.85) {\r\n                // Bluish white\r\n                starColors[i * 3] = 0.8;\r\n                starColors[i * 3 + 1] = 0.9;\r\n                starColors[i * 3 + 2] = 1;\r\n            } else {\r\n                // Yellowish white\r\n                starColors[i * 3] = 1;\r\n                starColors[i * 3 + 1] = 0.95;\r\n                starColors[i * 3 + 2] = 0.8;\r\n            }\r\n        }\r\n\r\n        starGeometry.setAttribute('position', new THREE.BufferAttribute(starPositions, 3));\r\n        starGeometry.setAttribute('color', new THREE.BufferAttribute(starColors, 3));\r\n\r\n        const starMaterial = new THREE.PointsMaterial({\r\n            size: 10,\r\n            vertexColors: true,\r\n            sizeAttenuation: true,\r\n            transparent: true,\r\n            opacity: 0.8\r\n        });\r\n\r\n        const stars = new THREE.Points(starGeometry, starMaterial);\r\n        scene.add(stars);\r\n    }\r\n\r\n    createStarField();\r\n\r\n    // Trail (orbit path) - sample points stored as Vector3 and rendered smooth via Catmull-Rom\r\n    const trailPoints: THREE.Vector3[] = [];\r\n    const trailGeometry = new THREE.BufferGeometry();\r\n    const trailMaterial = new THREE.LineBasicMaterial({ color: 0x00ff88 });\r\n    const trailLine = new THREE.Line(trailGeometry, trailMaterial);\r\n    scene.add(trailLine);\r\n\r\n    function addTrailPoint(p: THREE.Vector3) {\r\n        const maxPoints = 2000;\r\n        trailPoints.push(p.clone());\r\n        if (trailPoints.length > maxPoints) {\r\n            trailPoints.shift();\r\n        }\r\n\r\n        if (trailPoints.length >= 2) {\r\n            const curve = new THREE.CatmullRomCurve3(trailPoints, false, 'catmullrom', 0.5);\r\n            const divisions = Math.min(Math.max(trailPoints.length * 6, 64), 3000);\r\n            const smoothPoints = curve.getPoints(divisions);\r\n            const positions: number[] = [];\r\n            for (let i = 0; i < smoothPoints.length; i++) {\r\n                positions.push(smoothPoints[i].x, smoothPoints[i].y, smoothPoints[i].z);\r\n            }\r\n            trailGeometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));\r\n            trailGeometry.setDrawRange(0, positions.length / 3);\r\n            trailGeometry.computeBoundingSphere();\r\n        }\r\n    }\r\n\r\n    // ====================================================================\r\n    // Velocity Vector Visualization\r\n    // ====================================================================\r\n    // Display probe's velocity as an arrow (direction and magnitude)\r\n    const velocityArrow = new THREE.ArrowHelper(\r\n        new THREE.Vector3(1, 0, 0), // initial direction\r\n        probe.position,              // origin\r\n        10,                          // length\r\n        0xff0000,                    // color (red)\r\n        3,                           // head length\r\n        2                            // head width\r\n    );\r\n    scene.add(velocityArrow);\r\n\r\n    function updateVelocityArrow() {\r\n        const speed = state.velocity.length();\r\n        if (speed > 0.001) {\r\n            const direction = state.velocity.clone().normalize();\r\n            velocityArrow.setDirection(direction);\r\n            // Scale arrow length with speed (but cap at reasonable size)\r\n            const arrowLength = Math.min(speed * 2, 50);\r\n            velocityArrow.setLength(arrowLength, 3, 2);\r\n\r\n            // Color based on speed (blue -> green -> yellow -> red)\r\n            const speedRatio = Math.min(speed / 50, 1); // normalize to 0-1\r\n            if (speedRatio < 0.33) {\r\n                // Blue to green\r\n                const t = speedRatio / 0.33;\r\n                velocityArrow.setColor(new THREE.Color(0, t, 1 - t));\r\n            } else if (speedRatio < 0.66) {\r\n                // Green to yellow\r\n                const t = (speedRatio - 0.33) / 0.33;\r\n                velocityArrow.setColor(new THREE.Color(t, 1, 0));\r\n            } else {\r\n                // Yellow to red\r\n                const t = (speedRatio - 0.66) / 0.34;\r\n                velocityArrow.setColor(new THREE.Color(1, 1 - t, 0));\r\n            }\r\n\r\n            velocityArrow.position.copy(state.position);\r\n            velocityArrow.visible = true;\r\n        } else {\r\n            velocityArrow.visible = false;\r\n        }\r\n    }\r\n\r\n    // ====================================================================\r\n    // Swing-by Influence Zones Visualization\r\n    // ====================================================================\r\n    // Display encounter radius around each planet as a torus (donut ring)\r\n    const influenceZones: THREE.Mesh[] = [];\r\n\r\n    for (const pm of planetMeshes) {\r\n        const planetData = solarDefs.find(pd => pd.id === pm.id);\r\n        if (!planetData) continue;\r\n\r\n        const encounterRadius = planetData.radius * 2.5; // encounterMultiplier\r\n\r\n        // Create torus (ring)\r\n        const torusGeometry = new THREE.TorusGeometry(\r\n            encounterRadius,           // radius\r\n            encounterRadius * 0.08,    // tube thickness (8% of radius)\r\n            8,                         // radial segments\r\n            64                         // tubular segments\r\n        );\r\n\r\n        const torusMaterial = new THREE.MeshBasicMaterial({\r\n            color: 0x00ff00,\r\n            transparent: true,\r\n            opacity: 0.25,\r\n            side: THREE.DoubleSide\r\n        });\r\n\r\n        const torus = new THREE.Mesh(torusGeometry, torusMaterial);\r\n        // Rotate to align with XZ plane (horizontal)\r\n        torus.rotation.x = Math.PI / 2;\r\n        torus.position.copy(pm.mesh.position);\r\n        scene.add(torus);\r\n        influenceZones.push(torus);\r\n\r\n        // Store reference for updating position\r\n        (pm as any).influenceZone = torus;\r\n    }\r\n\r\n    // ====================================================================\r\n    // Planetary Orbit Visualization\r\n    // ====================================================================\r\n    // Display circular orbits for each planet\r\n    const orbitLines: THREE.Line[] = [];\r\n\r\n    for (const pd of solarDefs) {\r\n        const orbitRadius = pd.rAU * AU;\r\n        const segments = 128; // Number of points in the circle\r\n        const points: THREE.Vector3[] = [];\r\n\r\n        // Create circle points\r\n        for (let i = 0; i <= segments; i++) {\r\n            const theta = (i / segments) * Math.PI * 2;\r\n            const x = Math.cos(theta) * orbitRadius;\r\n            const z = Math.sin(theta) * orbitRadius;\r\n            points.push(new THREE.Vector3(x, 0, z));\r\n        }\r\n\r\n        // Create line geometry\r\n        const orbitGeometry = new THREE.BufferGeometry().setFromPoints(points);\r\n        const orbitMaterial = new THREE.LineBasicMaterial({\r\n            color: pd.color,\r\n            transparent: true,\r\n            opacity: 0.3,\r\n            linewidth: 1\r\n        });\r\n\r\n        const orbitLine = new THREE.Line(orbitGeometry, orbitMaterial);\r\n        scene.add(orbitLine);\r\n        orbitLines.push(orbitLine);\r\n    }\r\n\r\n    // ====================================================================\r\n    // Predicted Trajectory Visualization (Phase 2)\r\n    // ====================================================================\r\n    // Display future trajectory based on current velocity and gravity\r\n    const predictionPoints: THREE.Vector3[] = [];\r\n    const predictionGeometry = new THREE.BufferGeometry();\r\n    const predictionMaterial = new THREE.LineDashedMaterial({\r\n        color: 0xffaa00,\r\n        dashSize: 3,\r\n        gapSize: 2,\r\n        linewidth: 1,\r\n        transparent: true,\r\n        opacity: 0.6\r\n    });\r\n    const predictionLine = new THREE.Line(predictionGeometry, predictionMaterial);\r\n    scene.add(predictionLine);\r\n\r\n    // Success prediction indicators (text sprites near planets)\r\n    const successIndicators: { planetId: string; mesh: THREE.Sprite; probability: number }[] = [];\r\n\r\n    function createTextSprite(text: string, color: number = 0xffffff): THREE.Sprite {\r\n        const canvas = document.createElement('canvas');\r\n        const context = canvas.getContext('2d')!;\r\n        canvas.width = 256;\r\n        canvas.height = 128;\r\n        context.font = 'Bold 48px Arial';\r\n        context.fillStyle = `#${color.toString(16).padStart(6, '0')}`;\r\n        context.textAlign = 'center';\r\n        context.textBaseline = 'middle';\r\n        context.fillText(text, 128, 64);\r\n\r\n        const texture = new THREE.CanvasTexture(canvas);\r\n        const spriteMaterial = new THREE.SpriteMaterial({ map: texture, transparent: true });\r\n        const sprite = new THREE.Sprite(spriteMaterial);\r\n        sprite.scale.set(20, 10, 1);\r\n        return sprite;\r\n    }\r\n\r\n    // Create success indicators for each planet\r\n    for (const pm of planetMeshes) {\r\n        const sprite = createTextSprite('', 0x00ff00);\r\n        sprite.visible = false;\r\n        scene.add(sprite);\r\n        successIndicators.push({ planetId: pm.id, mesh: sprite, probability: 0 });\r\n    }\r\n\r\n    let lastPredictionUpdate = 0;\r\n    const predictionUpdateInterval = 500; // Update every 500ms\r\n\r\n    function updatePredictedTrajectory() {\r\n        const now = performance.now();\r\n        if (now - lastPredictionUpdate < predictionUpdateInterval) return;\r\n        lastPredictionUpdate = now;\r\n\r\n        // Clone current bodies state for prediction\r\n        const predictedBodies = cloneBodies(bodies);\r\n        const probeIndex = predictedBodies.findIndex(b => b.id === 'probe');\r\n        if (probeIndex < 0) return;\r\n\r\n        // Run simulation forward for predictionTime seconds\r\n        const predictionTime = 15; // seconds\r\n        const predictionSteps = 150; // number of points\r\n        const dt = predictionTime / predictionSteps;\r\n\r\n        predictionPoints.length = 0;\r\n        predictionPoints.push(new THREE.Vector3(\r\n            predictedBodies[probeIndex].position[0],\r\n            predictedBodies[probeIndex].position[1],\r\n            predictedBodies[probeIndex].position[2]\r\n        ));\r\n\r\n        // Reset success probabilities\r\n        for (const indicator of successIndicators) {\r\n            indicator.probability = 0;\r\n        }\r\n\r\n        const gRun = options?.G ?? DEFAULT_G;\r\n        let predSimTime = simTime;\r\n\r\n        // Simulate future trajectory\r\n        for (let i = 0; i < predictionSteps; i++) {\r\n            const { bodies: nextBodies, events } = stepBodies(predictedBodies, dt, gRun, predSimTime, 0.5, swingOptions);\r\n            predSimTime += dt;\r\n\r\n            // Copy nextBodies back to predictedBodies (safely handle type)\r\n            for (let j = 0; j < nextBodies.length; j++) {\r\n                predictedBodies[j] = { ...nextBodies[j] } as any;\r\n            }\r\n\r\n            // Store probe position\r\n            const probePos = predictedBodies[probeIndex].position;\r\n            predictionPoints.push(new THREE.Vector3(probePos[0], probePos[1], probePos[2]));\r\n\r\n            // Check for predicted swing-bys\r\n            if (events && events.swingBys && events.swingBys.length > 0) {\r\n                for (const ev of events.swingBys) {\r\n                    if (ev.probeId === 'probe') {\r\n                        const indicator = successIndicators.find(ind => ind.planetId === ev.bodyId);\r\n                        if (indicator) {\r\n                            // Calculate success probability based on deltaV\r\n                            const probability = Math.min(ev.deltaV / 1.0, 1.0) * 100;\r\n                            indicator.probability = Math.max(indicator.probability, probability);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // Update prediction line geometry\r\n        if (predictionPoints.length >= 2) {\r\n            const positions: number[] = [];\r\n            for (const point of predictionPoints) {\r\n                positions.push(point.x, point.y, point.z);\r\n            }\r\n            predictionGeometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));\r\n            predictionGeometry.computeBoundingSphere();\r\n            predictionLine.computeLineDistances(); // Required for dashed lines\r\n            predictionLine.visible = true;\r\n        } else {\r\n            predictionLine.visible = false;\r\n        }\r\n\r\n        // Update success indicators\r\n        for (const indicator of successIndicators) {\r\n            if (indicator.probability > 0) {\r\n                const pm = planetMeshes.find(p => p.id === indicator.planetId);\r\n                if (pm) {\r\n                    // Position indicator above planet\r\n                    const planetData = solarDefs.find(pd => pd.id === indicator.planetId);\r\n                    const offset = planetData ? planetData.radius * 4 : 30;\r\n                    indicator.mesh.position.set(\r\n                        pm.mesh.position.x,\r\n                        pm.mesh.position.y + offset,\r\n                        pm.mesh.position.z\r\n                    );\r\n\r\n                    // Update text based on probability\r\n                    const probabilityText = `${Math.round(indicator.probability)}%`;\r\n                    const color = indicator.probability > 70 ? 0x00ff00 :\r\n                                  indicator.probability > 40 ? 0xffaa00 : 0xff0000;\r\n\r\n                    // Update sprite texture\r\n                    const canvas = document.createElement('canvas');\r\n                    const context = canvas.getContext('2d')!;\r\n                    canvas.width = 256;\r\n                    canvas.height = 128;\r\n                    context.font = 'Bold 48px Arial';\r\n                    context.fillStyle = `#${color.toString(16).padStart(6, '0')}`;\r\n                    context.textAlign = 'center';\r\n                    context.textBaseline = 'middle';\r\n                    context.fillText(probabilityText, 128, 64);\r\n\r\n                    const texture = new THREE.CanvasTexture(canvas);\r\n                    indicator.mesh.material.map = texture;\r\n                    indicator.mesh.material.needsUpdate = true;\r\n                    indicator.mesh.visible = true;\r\n                }\r\n            } else {\r\n                indicator.mesh.visible = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    // Simulation state derived from bodies: expose probe state for HUD and visual sync\r\n    const state: ProbeState = {\r\n        position: probe.position.clone(),\r\n        velocity: new THREE.Vector3(probeBody.velocity[0], probeBody.velocity[1], probeBody.velocity[2]),\r\n        distance: 0,\r\n        fuel: 100,\r\n        slingshots: 0,\r\n        status: 'Idle',\r\n    };\r\n\r\n    // --- CENTER-OF-MASS (COM) position zeroing ---\r\n    // Shift all body positions so that the initial center-of-mass position is at the origin.\r\n    (function zeroCOMPosition() {\r\n        let mx = 0, my = 0, mz = 0;\r\n        let totalMass = 0;\r\n        for (const b of bodies) {\r\n            mx += b.mass * b.position[0];\r\n            my += b.mass * b.position[1];\r\n            mz += b.mass * b.position[2];\r\n            totalMass += b.mass;\r\n        }\r\n        if (totalMass > 0) {\r\n            const cx = mx / totalMass;\r\n            const cy = my / totalMass;\r\n            const cz = mz / totalMass;\r\n            // subtract COM position from each body's position\r\n            for (const b of bodies) {\r\n                b.position[0] -= cx;\r\n                b.position[1] -= cy;\r\n                b.position[2] -= cz;\r\n            }\r\n            // adjust visual meshes to match new positions\r\n            try {\r\n                starMesh.position.set(bodies.find((b) => b.id === 'star')!.position[0], bodies.find((b) => b.id === 'star')!.position[1], bodies.find((b) => b.id === 'star')!.position[2]);\r\n                for (const pm of planetMeshes) {\r\n                    const b = bodies.find((bb) => bb.id === pm.id);\r\n                    if (b) pm.mesh.position.set(b.position[0], b.position[1], b.position[2]);\r\n                }\r\n                // probe\r\n                const pb = bodies.find((b) => b.id === 'probe');\r\n                if (pb) {\r\n                    probe.position.set(pb.position[0], pb.position[1], pb.position[2]);\r\n                    state.position.copy(probe.position);\r\n                }\r\n            } catch (e) {\r\n                // ignore if meshes not ready\r\n            }\r\n            console.log('COM-zero position applied:', cx.toFixed(3), cy.toFixed(3), cz.toFixed(3));\r\n        }\r\n    })();\r\n\r\n    function onResize() {\r\n        camera.aspect = window.innerWidth / window.innerHeight;\r\n        camera.updateProjectionMatrix();\r\n        renderer.setSize(window.innerWidth, window.innerHeight);\r\n        renderer.setPixelRatio(Math.min(window.devicePixelRatio || 1, 2));\r\n    }\r\n\r\n    window.addEventListener('resize', onResize);\r\n\r\n    let simTime = 0;\r\n\r\n    // swing-by tuning options (tweak these values)\r\n    // With realistic Sun/planet mass ratios, swing-by effects are smaller for inner planets\r\n    // but significant for gas giants (Jupiter, Saturn). Threshold adjusted accordingly.\r\n    const swingOptions = {\r\n        encounterMultiplier: 2.5,   // Slightly wider detection radius\r\n        deltaVThreshold: 0.01,      // Lower threshold to catch smaller effects (was 0.03)\r\n        minGap: 0.4                 // Shorter cooldown between detections\r\n    };\r\n\r\n    // simple visual markers for swing-by events\r\n    const eventMarkers: THREE.Mesh[] = [];\r\n\r\n    function stepSimulation(dt: number) {\r\n        // call physics.stepBodies with plain-data bodies\r\n        const gRun = options?.G ?? DEFAULT_G;\r\n        const { bodies: nextBodies, events } = stepBodies(bodies, dt, gRun, simTime, 0.5, swingOptions);\r\n        simTime += dt;\r\n\r\n        // apply nextBodies back to visuals and local bodies\r\n        for (const nb of nextBodies) {\r\n                const idx = bodies.findIndex((b) => b.id === nb.id);\r\n                // if the body is marked static (e.g., the central star), don't overwrite its position\r\n                const orig = idx >= 0 ? bodies[idx] : null;\r\n                if (idx >= 0 && !orig?.isStatic) {\r\n                    bodies[idx] = nb;\r\n                }\r\n            // apply to mesh\r\n            if (nb.id === 'probe') {\r\n                probe.position.set(nb.position[0], nb.position[1], nb.position[2]);\r\n                state.position.copy(probe.position);\r\n                state.velocity.set(nb.velocity[0], nb.velocity[1], nb.velocity[2]);\r\n                // accumulate distance -- simple approximation\r\n                state.distance += vecLen([nb.velocity[0] * dt, nb.velocity[1] * dt, nb.velocity[2] * dt]);\r\n                // Update status: check fuel first, then velocity\r\n                if (state.fuel <= 0) {\r\n                    state.status = 'Fuel Depleted';\r\n                } else {\r\n                    state.status = state.velocity.length() > 1e-3 ? 'Running' : 'Idle';\r\n                }\r\n\r\n                // Smoothly rotate probe to face velocity direction\r\n                const speed = state.velocity.length();\r\n                if (speed > 0.1) { // Only rotate if moving fast enough\r\n                    // Calculate target direction from velocity vector\r\n                    const direction = state.velocity.clone().normalize();\r\n\r\n                    // Create a matrix that looks in the velocity direction\r\n                    // Note: direction is negated because the 3D model's front faces the opposite way\r\n                    const targetMatrix = new THREE.Matrix4();\r\n                    targetMatrix.lookAt(\r\n                        new THREE.Vector3(0, 0, 0),  // origin\r\n                        direction.negate(),           // reversed direction (model's front is opposite)\r\n                        new THREE.Vector3(0, 1, 0)   // up vector\r\n                    );\r\n\r\n                    // Extract target quaternion from matrix\r\n                    const targetQuaternion = new THREE.Quaternion();\r\n                    targetQuaternion.setFromRotationMatrix(targetMatrix);\r\n\r\n                    // Smoothly interpolate (slerp) from current to target rotation\r\n                    // Lower value = smoother/slower rotation, higher = faster\r\n                    const rotationSpeed = 0.15; // 15% per frame\r\n                    probe.quaternion.slerp(targetQuaternion, rotationSpeed);\r\n                }\r\n            }\r\n            // update planet meshes (check if this body's id is in planetMeshes array)\r\n            const pm = planetMeshes.find((p) => p.id === nb.id);\r\n            if (pm) {\r\n                pm.mesh.position.set(nb.position[0], nb.position[1], nb.position[2]);\r\n                // Update influence zone position to match planet\r\n                if ((pm as any).influenceZone) {\r\n                    (pm as any).influenceZone.position.copy(pm.mesh.position);\r\n                }\r\n            }\r\n            // (star is now movable) synchronize star mesh to its simulated position\r\n            if (nb.id === 'star') {\r\n                starMesh.position.set(nb.position[0], nb.position[1], nb.position[2]);\r\n            }\r\n        }\r\n\r\n        // Update velocity arrow visualization\r\n        updateVelocityArrow();\r\n\r\n        // Update predicted trajectory (Phase 2)\r\n        updatePredictedTrajectory();\r\n\r\n        // Update gravity well grid if enabled\r\n        updateGravityWellGrid();\r\n\r\n        // handle events (swing-bys)\r\n        if (events && events.swingBys && events.swingBys.length) {\r\n            for (const ev of events.swingBys) {\r\n                if (ev.probeId === 'probe') {\r\n                    state.slingshots += 1;\r\n                    console.log(`Swing-by detected at t=${ev.time.toFixed(2)}: probe around ${ev.bodyId} deltaV=${ev.deltaV.toFixed(3)}`);\r\n                    // find body position for marker\r\n                    const body = nextBodies.find((b) => b.id === ev.bodyId);\r\n                    if (body) {\r\n                        const markerGeom = new THREE.SphereGeometry(0.8, 8, 8);\r\n                        const markerMat = new THREE.MeshBasicMaterial({ color: 0xff0000 });\r\n                        const marker = new THREE.Mesh(markerGeom, markerMat);\r\n                        marker.position.set(body.position[0], body.position[1], body.position[2]);\r\n                        scene.add(marker);\r\n                        eventMarkers.push(marker);\r\n                        // fade out marker after 1.2s\r\n                        setTimeout(() => {\r\n                            scene.remove(marker);\r\n                            const i = eventMarkers.indexOf(marker);\r\n                            if (i >= 0) eventMarkers.splice(i, 1);\r\n                        }, 1200);\r\n                    }\r\n                    // flash probe material if available (main body)\r\n                    try {\r\n                        const bodyMesh: any = probe.children[0]; // Main body is first child\r\n                        const mat: any = bodyMesh?.material;\r\n                        if (mat && mat.emissive) {\r\n                            const prev = mat.emissive.clone ? mat.emissive.clone() : null;\r\n                            mat.emissive.setHex(0xff4444);\r\n                            setTimeout(() => {\r\n                                if (prev && mat.emissive && mat.emissive.set) mat.emissive.copy(prev);\r\n                            }, 500);\r\n                        }\r\n                    } catch (e) {\r\n                        // ignore material issues\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // bind the exported applyDeltaVToProbe to modify the local bodies array\r\n    (function bindApply() {\r\n        const mod = (dv: [number, number, number]) => {\r\n            const idx = bodies.findIndex((b) => b.id === 'probe');\r\n            if (idx >= 0) {\r\n                bodies[idx].velocity[0] += dv[0];\r\n                bodies[idx].velocity[1] += dv[1];\r\n                bodies[idx].velocity[2] += dv[2];\r\n            }\r\n        };\r\n        try {\r\n            // expose on window so consumer code in GameCanvas can call it reliably\r\n            (window as any).__applyDeltaVToProbe = mod;\r\n        } catch (e) {\r\n            // ignore if window isn't available\r\n        }\r\n    })();\r\n\r\n    // ====================================================================\r\n    // Gravity Well Grid Update Function\r\n    // ====================================================================\r\n    function updateGravityWellGrid() {\r\n        if (!gravityWellMesh.visible) return;\r\n\r\n        const positions = gravityWellGeometry.attributes.position.array as Float32Array;\r\n        const gVal = options?.G ?? DEFAULT_G;\r\n        const depthScale = 50; // Scale factor for visual effect (adjust for visibility)\r\n\r\n        // Reset to original positions\r\n        for (let i = 0; i < positions.length; i++) {\r\n            positions[i] = originalPositions[i];\r\n        }\r\n\r\n        // Calculate reference potential at grid corners (far from bodies)\r\n        const halfSize = gridSize / 2;\r\n        const cornerPositions = [\r\n            [halfSize, halfSize],\r\n            [halfSize, -halfSize],\r\n            [-halfSize, halfSize],\r\n            [-halfSize, -halfSize]\r\n        ];\r\n\r\n        let referencePotential = 0;\r\n        for (const [cx, cz] of cornerPositions) {\r\n            let cornerPotential = 0;\r\n            for (const body of bodies) {\r\n                if (body.isProbe) continue;\r\n                const dx = cx - body.position[0];\r\n                const dz = cz - body.position[2];\r\n                const distance = Math.sqrt(dx * dx + dz * dz);\r\n                if (distance > 0.1) {\r\n                    cornerPotential += -(gVal * body.mass) / distance;\r\n                }\r\n            }\r\n            referencePotential += cornerPotential;\r\n        }\r\n        referencePotential /= cornerPositions.length; // Average\r\n\r\n        // Apply gravitational deformation for each vertex\r\n        for (let i = 0; i < positions.length; i += 3) {\r\n            const x = positions[i];\r\n            const z = positions[i + 2];\r\n            let totalPotential = 0;\r\n\r\n            // Calculate gravitational potential from all massive bodies\r\n            for (const body of bodies) {\r\n                if (body.isProbe) continue; // Skip probe (negligible mass)\r\n\r\n                const dx = x - body.position[0];\r\n                const dz = z - body.position[2];\r\n                const distance = Math.sqrt(dx * dx + dz * dz);\r\n\r\n                if (distance > 0.1) { // Avoid division by zero\r\n                    // Gravitational potential: -GM/r (negative, creates a well)\r\n                    const potential = -(gVal * body.mass) / distance;\r\n                    totalPotential += potential;\r\n                }\r\n            }\r\n\r\n            // Apply depth relative to reference (grid edges at Y=0)\r\n            const relativeDepth = totalPotential - referencePotential;\r\n            positions[i + 1] = relativeDepth * depthScale;\r\n        }\r\n\r\n        gravityWellGeometry.attributes.position.needsUpdate = true;\r\n        gravityWellGeometry.computeVertexNormals(); // Update normals for proper lighting\r\n    }\r\n\r\n    // Toggle gravity grid visibility\r\n    function updateGravityGrid(enabled: boolean) {\r\n        gravityWellMesh.visible = enabled;\r\n        grid.visible = !enabled;\r\n        if (enabled) {\r\n            updateGravityWellGrid();\r\n        }\r\n    }\r\n\r\n    function dispose() {\r\n        window.removeEventListener('resize', onResize);\r\n        renderer.dispose();\r\n        scene.traverse((obj: any) => {\r\n            if (obj.geometry) obj.geometry.dispose?.();\r\n            if (obj.material) {\r\n                const mat = obj.material as any;\r\n                if (Array.isArray(mat)) mat.forEach((m) => m.dispose && m.dispose());\r\n                else mat.dispose && mat.dispose();\r\n            }\r\n        });\r\n    }\r\n\r\n    return { scene, camera, renderer, dispose, state, probe, controls, addTrailPoint, stepSimulation, updateGravityGrid };\r\n}\r\n\r\n// small helper to allow external callers to apply delta-v to the probe\r\n// We'll export a typed wrapper that others can call if they capture the\r\n// init's return value; but for convenience also provide this function\r\n// that will be replaced when initThreeJS is called.\r\nexport function applyDeltaVToProbe(_dv: [number, number, number]) {\r\n    // no-op placeholder; actual implementation bound in initThreeJS's closure\r\n    console.warn('applyDeltaVToProbe called before init; ignoring');\r\n}\r\n\r\n// small helper to compute vector length for [x,y,z]\r\nfunction vecLen(v: [number, number, number]) {\r\n    return Math.sqrt(v[0] * v[0] + v[1] * v[1] + v[2] * v[2]);\r\n}\r\n\r\nexport default initThreeJS;\r\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;AACA;AACA;;;;;AAYO,MAAM,gBAAgB;IACzB,+BAA+B;IAC/B,YAAY;IACZ,UAAU;IAEV,yCAAyC;IACzC,IAAI;IAEJ,mDAAmD;IACnD,6DAA6D;IAC7D,YAAY;IAEZ,gDAAgD;IAChD,gEAAgE;IAChE,GAAG;IAEH,+CAA+C;IAC/C,wEAAwE;IACxE,wBAAwB;IAExB,qDAAqD;IACrD,wEAAwE;IACxE,qFAAqF;IACrF,uBAAuB;AAC3B;AAGO,MAAM,YAAY,cAAc,CAAC;AAWxC,uEAAuE;AACvE,iCAAiC;AACjC,uEAAuE;AAEvE;;CAEC,GACD,SAAS;IACL,MAAM,QAAQ,IAAI,6JAAW;IAE7B,8CAA8C;IAC9C,MAAM,WAAW,IAAI,wKAAsB,CAAC,KAAK,KAAK,KAAK;IAC3D,MAAM,UAAU,IAAI,4KAA0B,CAAC;QAAE,OAAO;QAAU,WAAW;QAAK,WAAW;IAAI;IACjG,MAAM,OAAO,IAAI,4JAAU,CAAC,UAAU;IACtC,KAAK,QAAQ,CAAC,CAAC,GAAG,KAAK,EAAE,GAAG;IAC5B,MAAM,GAAG,CAAC;IAEV,2BAA2B;IAC3B,MAAM,WAAW,IAAI,wKAAsB,CAAC,KAAK,KAAK,KAAK;IAC3D,MAAM,UAAU,IAAI,4KAA0B,CAAC;QAAE,OAAO;QAAU,WAAW;QAAK,WAAW;IAAI;IACjG,MAAM,OAAO,IAAI,4JAAU,CAAC,UAAU;IACtC,KAAK,QAAQ,CAAC,CAAC,GAAG,KAAK,EAAE,GAAG;IAC5B,KAAK,QAAQ,CAAC,GAAG,CAAC,GAAG,GAAG;IACxB,MAAM,GAAG,CAAC;IAEV,gCAAgC;IAChC,MAAM,WAAW,IAAI,oKAAkB,CAAC,MAAM,KAAK;IACnD,MAAM,UAAU,IAAI,4KAA0B,CAAC;QAAE,OAAO;IAAS;IACjE,MAAM,OAAO,IAAI,4JAAU,CAAC,UAAU;IACtC,KAAK,QAAQ,CAAC,CAAC,GAAG,KAAK,EAAE,GAAG;IAC5B,KAAK,QAAQ,CAAC,GAAG,CAAC,GAAG,GAAG;IACxB,MAAM,GAAG,CAAC;IAEV,mDAAmD;IACnD,MAAM,cAAc,IAAI,wKAAsB,CAAC,MAAM,MAAM,GAAG;IAC9D,MAAM,aAAa,IAAI,4KAA0B,CAAC;QAAE,OAAO;IAAS;IACpE,MAAM,UAAU,IAAI,4JAAU,CAAC,aAAa;IAC5C,QAAQ,QAAQ,CAAC,CAAC,GAAG,KAAK,EAAE,GAAG;IAC/B,QAAQ,QAAQ,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,KAAK;IACjC,MAAM,GAAG,CAAC;IAEV,wCAAwC;IACxC,MAAM,UAAU,IAAI,mKAAiB,CAAC,KAAK,KAAK;IAChD,MAAM,SAAS,IAAI,4KAA0B,CAAC;QAAE,OAAO;QAAU,UAAU;IAAS;IACpF,MAAM,MAAM,IAAI,4JAAU,CAAC,SAAS;IACpC,IAAI,QAAQ,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,KAAK;IAC3B,MAAM,GAAG,CAAC;IAEV,oBAAoB;IACpB,MAAM,cAAc,IAAI,wKAAsB,CAAC,MAAM,MAAM,GAAG;IAC9D,MAAM,aAAa,IAAI,4KAA0B,CAAC;QAAE,OAAO;IAAS;IACpE,MAAM,UAAU,IAAI,4JAAU,CAAC,aAAa;IAC5C,QAAQ,QAAQ,CAAC,CAAC,GAAG,KAAK,EAAE,GAAG;IAC/B,QAAQ,QAAQ,CAAC,GAAG,CAAC,GAAG,KAAK;IAC7B,MAAM,GAAG,CAAC;IAEV,sBAAsB;IACtB,MAAM,gBAAgB,IAAI,mKAAiB,CAAC,MAAM,MAAM;IACxD,MAAM,eAAe,IAAI,4KAA0B,CAAC;QAAE,OAAO;IAAS;IACtE,MAAM,YAAY,IAAI,4JAAU,CAAC,eAAe;IAChD,UAAU,QAAQ,CAAC,GAAG,CAAC,GAAG,KAAK;IAC/B,MAAM,GAAG,CAAC;IAEV,+BAA+B;IAC/B,MAAM,kBAAkB,IAAI,mKAAiB,CAAC,KAAK,KAAK;IACxD,MAAM,iBAAiB,IAAI,4KAA0B,CAAC;QAAE,OAAO;IAAS;IACxE,MAAM,cAAc,IAAI,4JAAU,CAAC,iBAAiB;IACpD,YAAY,QAAQ,CAAC,GAAG,CAAC,GAAG,MAAM;IAClC,MAAM,GAAG,CAAC;IAEV,0BAA0B;IAC1B,MAAM,KAAK,CAAC,GAAG,CAAC,GAAG,GAAG;IAEtB,OAAO;AACX;AAEA;;;;;CAKC,GACD,SAAS,aACL,SAAiB,EACjB,MAAoC,EACpC,OAA6B;IAE7B,MAAM,SAAS,IAAI,kLAAU;IAE7B,OAAO,IAAI,CACP,WACA,CAAC;QACG,MAAM,QAAQ,KAAK,KAAK;QAExB,+CAA+C;QAC/C,qEAAqE;QACrE,MAAM,KAAK,CAAC,GAAG,CAAC,MAAM,MAAM;QAC5B,MAAM,QAAQ,CAAC,CAAC,GAAG,KAAK,EAAE,EAAE,+BAA+B;QAE3D,sCAAsC;QACtC,MAAM,QAAQ,CAAC,CAAC;YACZ,IAAI,MAAM,MAAM,IAAI,MAAM,QAAQ,EAAE;gBAChC,MAAM,WAAW,MAAM,QAAQ;gBAE/B,qDAAqD;gBACrD,MAAM,YAAY,MAAM,OAAO,CAAC,YAAY,WAAW;oBAAC;iBAAS;gBAEjE,UAAU,OAAO,CAAC,CAAC;oBACf,4BAA4B;oBAC5B,IAAI,IAAI,KAAK,EAAE;wBACX,IAAI,KAAK,CAAC,cAAc,CAAC,MAAM,qBAAqB;oBACxD;oBAEA,gDAAgD;oBAChD,IAAI,IAAI,SAAS,KAAK,WAAW;wBAC7B,IAAI,SAAS,GAAG,KAAK,GAAG,CAAC,IAAI,SAAS,GAAG,KAAK;oBAClD;oBACA,IAAI,IAAI,SAAS,KAAK,WAAW;wBAC7B,IAAI,SAAS,GAAG,KAAK,GAAG,CAAC,IAAI,SAAS,GAAG,KAAK;oBAClD;gBACJ;YACJ;QACJ;QAEA,QAAQ,GAAG,CAAC,kCAAkC;QAC9C,OAAO;IACX,GACA,CAAC;QACG,8BAA8B;QAC9B,MAAM,UAAU,AAAC,SAAS,MAAM,GAAG,SAAS,KAAK,GAAI;QACrD,QAAQ,GAAG,CAAC,CAAC,eAAe,EAAE,QAAQ,OAAO,CAAC,GAAG,CAAC,CAAC;IACvD,GACA,CAAC;QACG,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,QAAQ;IACZ;AAER;AAEO,SAAS,YAAY,MAAyB,EAAE,OAAkG;IACrJ,MAAM,QAAQ,IAAI,6JAAW;IAC7B,MAAM,SAAS,IAAI,yKAAuB,CAAC,IAAI,OAAO,UAAU,GAAG,OAAO,WAAW,EAAE,KAAK;IAC5F,OAAO,QAAQ,CAAC,GAAG,CAAC,GAAG,KAAK;IAE5B,MAAM,WAAW,IAAI,qKAAmB,CAAC;QAAE;QAAQ,WAAW;IAAK;IACnE,SAAS,OAAO,CAAC,OAAO,UAAU,EAAE,OAAO,WAAW;IACtD,SAAS,aAAa,CAAC,KAAK,GAAG,CAAC,OAAO,gBAAgB,IAAI,GAAG;IAE9D,MAAM,UAAU,IAAI,oKAAkB,CAAC,UAAU;IACjD,MAAM,GAAG,CAAC;IACV,MAAM,cAAc,IAAI,wKAAsB,CAAC,UAAU;IACzD,YAAY,QAAQ,CAAC,GAAG,CAAC,GAAG,IAAI;IAChC,MAAM,GAAG,CAAC;IAEV,iEAAiE;IACjE,MAAM,OAAO,IAAI,kKAAgB,CAAC,MAAM,MAAM,UAAU;IACxD,MAAM,GAAG,CAAC;IAEV,uEAAuE;IACvE,8DAA8D;IAC9D,uEAAuE;IACvE,MAAM,WAAW;IACjB,MAAM,gBAAgB,KAAK,uCAAuC;IAClE,MAAM,sBAAsB,IAAI,qKAAmB,CAAC,UAAU,UAAU,eAAe;IACvF,oBAAoB,OAAO,CAAC,CAAC,KAAK,EAAE,GAAG,IAAI,kCAAkC;IAE7E,0CAA0C;IAC1C,MAAM,sBAAsB,IAAI,yKAAuB,CAAC;QACpD,OAAO;QACP,WAAW;QACX,aAAa;QACb,SAAS;IACb;IAEA,MAAM,kBAAkB,IAAI,4JAAU,CAAC,qBAAqB;IAC5D,gBAAgB,OAAO,GAAG,SAAS,sBAAsB;IACzD,MAAM,GAAG,CAAC;IAEV,qCAAqC;IACrC,MAAM,oBAAoB,IAAI,aAAa,oBAAoB,UAAU,CAAC,QAAQ,CAAC,KAAK;IAExF,wDAAwD;IACxD,MAAM,SAAiB,EAAE;IACzB,MAAM,eAAmD,EAAE;IAE3D,yDAAyD;IACzD,MAAM,WAAW,SAAS,YAAY,cAAc,QAAQ;IAC5D,MAAM,WAAW,IAAI,sKAAoB,CAAC,GAAG,IAAI;IACjD,MAAM,UAAU,IAAI,4KAA0B,CAAC;QAAE,OAAO;QAAU,UAAU;IAAS;IACrF,MAAM,WAAW,IAAI,4JAAU,CAAC,UAAU;IAC1C,SAAS,QAAQ,CAAC,GAAG,CAAC,GAAG,GAAG;IAC5B,MAAM,GAAG,CAAC;IACV,oFAAoF;IACpF,OAAO,IAAI,CAAC;QAAE,IAAI;QAAQ,MAAM;QAAU,UAAU;YAAC;YAAG;YAAG;SAAE;QAAE,UAAU;YAAC;YAAG;YAAG;SAAE;QAAE,QAAQ;QAAG,SAAS;IAAM;IAE9G,4DAA4D;IAC5D,MAAM,KAAK,cAAc,EAAE;IAC3B,MAAM,YAAY;QACd;YAAE,IAAI;YAAW,KAAK;YAAM,QAAQ;YAAG,OAAO;YAAU,OAAO;YAAG,MAAM;QAAM;QAC9E;YAAE,IAAI;YAAW,KAAK;YAAM,QAAQ;YAAG,OAAO;YAAU,OAAO;YAAK,MAAM;QAAM;QAChF;YAAE,IAAI;YAAW,KAAK;YAAM,QAAQ;YAAK,OAAO;YAAU,OAAO;YAAK,MAAM;QAAI;QAChF;YAAE,IAAI;YAAW,KAAK;YAAM,QAAQ;YAAG,OAAO;YAAU,OAAO;YAAK,MAAM;QAAM;QAChF;YAAE,IAAI;YAAW,KAAK;YAAM,QAAQ;YAAI,OAAO;YAAU,OAAO;YAAK,MAAM;QAAM;QACjF;YAAE,IAAI;YAAW,KAAK;YAAM,QAAQ;YAAI,OAAO;YAAU,OAAO;YAAK,MAAM;QAAM;QACjF;YAAE,IAAI;YAAW,KAAI;YAAO,QAAQ;YAAG,OAAO;YAAU,OAAO;YAAK,MAAM;QAAK;QAC/E;YAAE,IAAI;YAAW,KAAI;YAAO,QAAQ;YAAG,OAAO;YAAU,OAAO;YAAK,MAAM;QAAK;KAClF;IAED,MAAM,iBAAiB,UAAU,6BAA6B;IAC9D,KAAK,MAAM,MAAM,UAAW;QACxB,MAAM,MAAM,GAAG,GAAG,GAAG;QACrB,MAAM,OAAO,IAAI,sKAAoB,CAAC,GAAG,MAAM,EAAE,IAAI;QACrD,MAAM,MAAM,IAAI,4KAA0B,CAAC;YAAE,OAAO,GAAG,KAAK;QAAC;QAC7D,MAAM,OAAO,IAAI,4JAAU,CAAC,MAAM;QAClC,MAAM,IAAI,KAAK,GAAG,CAAC,GAAG,KAAK,IAAI;QAC/B,MAAM,IAAI,KAAK,GAAG,CAAC,GAAG,KAAK,IAAI;QAC/B,KAAK,QAAQ,CAAC,GAAG,CAAC,GAAG,GAAG;QACxB,MAAM,GAAG,CAAC;QACV,aAAa,IAAI,CAAC;YAAE,IAAI,GAAG,EAAE;YAAE;QAAK;QACxC,MAAM,OAAO,SAAS,KAAK;QAC3B,MAAM,IAAI,KAAK,IAAI,CAAC,AAAC,OAAO,iBAAkB;QAC1C,MAAM,KAAK,IAAI,KAAK,GAAG,CAAC,GAAG,KAAK;QAChC,MAAM,KAAK,CAAC,IAAI,KAAK,GAAG,CAAC,GAAG,KAAK;QACjC,OAAO,IAAI,CAAC;YAAE,IAAI,GAAG,EAAE;YAAE,MAAM,GAAG,IAAI;YAAE,UAAU;gBAAC;gBAAG;gBAAG;aAAE;YAAE,UAAU;gBAAC;gBAAI;gBAAG;aAAG;YAAE,QAAQ,GAAG,MAAM;QAAC;IAC1G;IAEA,0DAA0D;IAC1D,iFAAiF;IACjF,IAAI,QAAQ;IAEZ,MAAM,SAAS,KAAM,+BAA+B;IACpD,MAAM,QAAQ,CAAC,GAAG,CAAC,GAAG,GAAG;IACzB,MAAM,GAAG,CAAC;IAEV,0DAA0D;IAC1D,gEAAgE;IAChE,aACI,6BACA,CAAC;QACG,uDAAuD;QACvD,QAAQ,GAAG,CAAC;QAEZ,mDAAmD;QACnD,YAAY,QAAQ,CAAC,IAAI,CAAC,MAAM,QAAQ;QAExC,8BAA8B;QAC9B,MAAM,MAAM,CAAC;QAEb,4BAA4B;QAC5B,MAAM,GAAG,CAAC;QAEV,kDAAkD;QAClD,QAAQ;QAER,QAAQ,GAAG,CAAC;IAChB,GACA,CAAC;QACG,kDAAkD;QAClD,QAAQ,GAAG,CAAC;QACZ,QAAQ,KAAK,CAAC,sBAAsB;IACxC;IAGJ,MAAM,OAAO,SAAS,KAAK;IAC3B,MAAM,YAAY,SAAS,kBAAkB,MAAO,gDAAgD;IACpG,MAAM,YAAY,KAAK,IAAI,CAAC,AAAC,OAAO,WAAY;IAChD,MAAM,YAAkB;QAAE,IAAI;QAAS,MAAM;QAAG,UAAU;YAAC;YAAG;YAAG;SAAO;QAAE,UAAU;YAAC,YAAY;YAAW;YAAG;SAAE;QAAE,QAAQ;QAAK,SAAS;IAAK;IAC9I,OAAO,IAAI,CAAC;IAEZ,gDAAgD;IAChD,wEAAwE;IACxE,qEAAqE;IACrE,6DAA6D;IAC7D,CAAC,SAAS;QACN,IAAI,UAAU,GAAG,UAAU,GAAG,UAAU;QACxC,IAAI,YAAY;QAChB,KAAK,MAAM,KAAK,OAAQ;YACpB,WAAW,EAAE,IAAI,GAAG,EAAE,QAAQ,CAAC,EAAE;YACjC,WAAW,EAAE,IAAI,GAAG,EAAE,QAAQ,CAAC,EAAE;YACjC,WAAW,EAAE,IAAI,GAAG,EAAE,QAAQ,CAAC,EAAE;YACjC,aAAa,EAAE,IAAI;QACvB;QACA,IAAI,YAAY,GAAG;YACf,MAAM,KAAK,UAAU;YACrB,MAAM,KAAK,UAAU;YACrB,MAAM,KAAK,UAAU;YACrB,oEAAoE;YACpE,KAAK,MAAM,KAAK,OAAQ;gBACpB,EAAE,QAAQ,CAAC,EAAE,IAAI;gBACjB,EAAE,QAAQ,CAAC,EAAE,IAAI;gBACjB,EAAE,QAAQ,CAAC,EAAE,IAAI;YACrB;YACA,QAAQ,GAAG,CAAC,sCAAsC,GAAG,OAAO,CAAC,IAAI,GAAG,OAAO,CAAC,IAAI,GAAG,OAAO,CAAC;QAC/F;IACJ,CAAC;IAED,uEAAuE;IAEvE,uCAAuC;IACvC,MAAM,WAAW,IAAI,yLAAa,CAAC,QAAQ,SAAS,UAAU;IAC9D,SAAS,aAAa,GAAG;IACzB,SAAS,aAAa,GAAG;IACzB,SAAS,SAAS,GAAG;IACrB,SAAS,MAAM;IAEf,uEAAuE;IACvE,iCAAiC;IACjC,uEAAuE;IACvE,gEAAgE;IAChE,SAAS;QACL,MAAM,YAAY;QAClB,MAAM,eAAe,IAAI,sKAAoB;QAC7C,MAAM,gBAAgB,IAAI,aAAa,YAAY;QACnD,MAAM,aAAa,IAAI,aAAa,YAAY;QAEhD,IAAK,IAAI,IAAI,GAAG,IAAI,WAAW,IAAK;YAChC,0CAA0C;YAC1C,MAAM,SAAS,OAAO,KAAK,MAAM,KAAK,OAAO,mBAAmB;YAChE,MAAM,QAAQ,KAAK,MAAM,KAAK,KAAK,EAAE,GAAG,GAAK,OAAO;YACpD,MAAM,MAAM,KAAK,IAAI,CAAC,IAAI,KAAK,MAAM,KAAK,IAAI,uBAAuB;YAErE,aAAa,CAAC,IAAI,EAAE,GAAG,SAAS,KAAK,GAAG,CAAC,OAAO,KAAK,GAAG,CAAC;YACzD,aAAa,CAAC,IAAI,IAAI,EAAE,GAAG,SAAS,KAAK,GAAG,CAAC,OAAO,KAAK,GAAG,CAAC;YAC7D,aAAa,CAAC,IAAI,IAAI,EAAE,GAAG,SAAS,KAAK,GAAG,CAAC;YAE7C,wDAAwD;YACxD,MAAM,cAAc,KAAK,MAAM;YAC/B,IAAI,cAAc,KAAK;gBACnB,QAAQ;gBACR,UAAU,CAAC,IAAI,EAAE,GAAG;gBACpB,UAAU,CAAC,IAAI,IAAI,EAAE,GAAG;gBACxB,UAAU,CAAC,IAAI,IAAI,EAAE,GAAG;YAC5B,OAAO,IAAI,cAAc,MAAM;gBAC3B,eAAe;gBACf,UAAU,CAAC,IAAI,EAAE,GAAG;gBACpB,UAAU,CAAC,IAAI,IAAI,EAAE,GAAG;gBACxB,UAAU,CAAC,IAAI,IAAI,EAAE,GAAG;YAC5B,OAAO;gBACH,kBAAkB;gBAClB,UAAU,CAAC,IAAI,EAAE,GAAG;gBACpB,UAAU,CAAC,IAAI,IAAI,EAAE,GAAG;gBACxB,UAAU,CAAC,IAAI,IAAI,EAAE,GAAG;YAC5B;QACJ;QAEA,aAAa,YAAY,CAAC,YAAY,IAAI,uKAAqB,CAAC,eAAe;QAC/E,aAAa,YAAY,CAAC,SAAS,IAAI,uKAAqB,CAAC,YAAY;QAEzE,MAAM,eAAe,IAAI,sKAAoB,CAAC;YAC1C,MAAM;YACN,cAAc;YACd,iBAAiB;YACjB,aAAa;YACb,SAAS;QACb;QAEA,MAAM,QAAQ,IAAI,8JAAY,CAAC,cAAc;QAC7C,MAAM,GAAG,CAAC;IACd;IAEA;IAEA,2FAA2F;IAC3F,MAAM,cAA+B,EAAE;IACvC,MAAM,gBAAgB,IAAI,sKAAoB;IAC9C,MAAM,gBAAgB,IAAI,yKAAuB,CAAC;QAAE,OAAO;IAAS;IACpE,MAAM,YAAY,IAAI,4JAAU,CAAC,eAAe;IAChD,MAAM,GAAG,CAAC;IAEV,SAAS,cAAc,CAAgB;QACnC,MAAM,YAAY;QAClB,YAAY,IAAI,CAAC,EAAE,KAAK;QACxB,IAAI,YAAY,MAAM,GAAG,WAAW;YAChC,YAAY,KAAK;QACrB;QAEA,IAAI,YAAY,MAAM,IAAI,GAAG;YACzB,MAAM,QAAQ,IAAI,wKAAsB,CAAC,aAAa,OAAO,cAAc;YAC3E,MAAM,YAAY,KAAK,GAAG,CAAC,KAAK,GAAG,CAAC,YAAY,MAAM,GAAG,GAAG,KAAK;YACjE,MAAM,eAAe,MAAM,SAAS,CAAC;YACrC,MAAM,YAAsB,EAAE;YAC9B,IAAK,IAAI,IAAI,GAAG,IAAI,aAAa,MAAM,EAAE,IAAK;gBAC1C,UAAU,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,CAAC,EAAE,YAAY,CAAC,EAAE,CAAC,CAAC,EAAE,YAAY,CAAC,EAAE,CAAC,CAAC;YAC1E;YACA,cAAc,YAAY,CAAC,YAAY,IAAI,8KAA4B,CAAC,WAAW;YACnF,cAAc,YAAY,CAAC,GAAG,UAAU,MAAM,GAAG;YACjD,cAAc,qBAAqB;QACvC;IACJ;IAEA,uEAAuE;IACvE,gCAAgC;IAChC,uEAAuE;IACvE,iEAAiE;IACjE,MAAM,gBAAgB,IAAI,mKAAiB,CACvC,IAAI,+JAAa,CAAC,GAAG,GAAG,IACxB,MAAM,QAAQ,EACd,IACA,UACA,GACA,EAA6B,aAAa;;IAE9C,MAAM,GAAG,CAAC;IAEV,SAAS;QACL,MAAM,QAAQ,MAAM,QAAQ,CAAC,MAAM;QACnC,IAAI,QAAQ,OAAO;YACf,MAAM,YAAY,MAAM,QAAQ,CAAC,KAAK,GAAG,SAAS;YAClD,cAAc,YAAY,CAAC;YAC3B,6DAA6D;YAC7D,MAAM,cAAc,KAAK,GAAG,CAAC,QAAQ,GAAG;YACxC,cAAc,SAAS,CAAC,aAAa,GAAG;YAExC,wDAAwD;YACxD,MAAM,aAAa,KAAK,GAAG,CAAC,QAAQ,IAAI,IAAI,mBAAmB;YAC/D,IAAI,aAAa,MAAM;gBACnB,gBAAgB;gBAChB,MAAM,IAAI,aAAa;gBACvB,cAAc,QAAQ,CAAC,IAAI,6JAAW,CAAC,GAAG,GAAG,IAAI;YACrD,OAAO,IAAI,aAAa,MAAM;gBAC1B,kBAAkB;gBAClB,MAAM,IAAI,CAAC,aAAa,IAAI,IAAI;gBAChC,cAAc,QAAQ,CAAC,IAAI,6JAAW,CAAC,GAAG,GAAG;YACjD,OAAO;gBACH,gBAAgB;gBAChB,MAAM,IAAI,CAAC,aAAa,IAAI,IAAI;gBAChC,cAAc,QAAQ,CAAC,IAAI,6JAAW,CAAC,GAAG,IAAI,GAAG;YACrD;YAEA,cAAc,QAAQ,CAAC,IAAI,CAAC,MAAM,QAAQ;YAC1C,cAAc,OAAO,GAAG;QAC5B,OAAO;YACH,cAAc,OAAO,GAAG;QAC5B;IACJ;IAEA,uEAAuE;IACvE,yCAAyC;IACzC,uEAAuE;IACvE,sEAAsE;IACtE,MAAM,iBAA+B,EAAE;IAEvC,KAAK,MAAM,MAAM,aAAc;QAC3B,MAAM,aAAa,UAAU,IAAI,CAAC,CAAA,KAAM,GAAG,EAAE,KAAK,GAAG,EAAE;QACvD,IAAI,CAAC,YAAY;QAEjB,MAAM,kBAAkB,WAAW,MAAM,GAAG,KAAK,sBAAsB;QAEvE,sBAAsB;QACtB,MAAM,gBAAgB,IAAI,qKAAmB,CACzC,iBACA,kBAAkB,MAClB,GACA,GAA2B,mBAAmB;;QAGlD,MAAM,gBAAgB,IAAI,yKAAuB,CAAC;YAC9C,OAAO;YACP,aAAa;YACb,SAAS;YACT,MAAM,kKAAgB;QAC1B;QAEA,MAAM,QAAQ,IAAI,4JAAU,CAAC,eAAe;QAC5C,6CAA6C;QAC7C,MAAM,QAAQ,CAAC,CAAC,GAAG,KAAK,EAAE,GAAG;QAC7B,MAAM,QAAQ,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,QAAQ;QACpC,MAAM,GAAG,CAAC;QACV,eAAe,IAAI,CAAC;QAEpB,wCAAwC;QACvC,GAAW,aAAa,GAAG;IAChC;IAEA,uEAAuE;IACvE,gCAAgC;IAChC,uEAAuE;IACvE,0CAA0C;IAC1C,MAAM,aAA2B,EAAE;IAEnC,KAAK,MAAM,MAAM,UAAW;QACxB,MAAM,cAAc,GAAG,GAAG,GAAG;QAC7B,MAAM,WAAW,KAAK,iCAAiC;QACvD,MAAM,SAA0B,EAAE;QAElC,uBAAuB;QACvB,IAAK,IAAI,IAAI,GAAG,KAAK,UAAU,IAAK;YAChC,MAAM,QAAQ,AAAC,IAAI,WAAY,KAAK,EAAE,GAAG;YACzC,MAAM,IAAI,KAAK,GAAG,CAAC,SAAS;YAC5B,MAAM,IAAI,KAAK,GAAG,CAAC,SAAS;YAC5B,OAAO,IAAI,CAAC,IAAI,+JAAa,CAAC,GAAG,GAAG;QACxC;QAEA,uBAAuB;QACvB,MAAM,gBAAgB,IAAI,sKAAoB,GAAG,aAAa,CAAC;QAC/D,MAAM,gBAAgB,IAAI,yKAAuB,CAAC;YAC9C,OAAO,GAAG,KAAK;YACf,aAAa;YACb,SAAS;YACT,WAAW;QACf;QAEA,MAAM,YAAY,IAAI,4JAAU,CAAC,eAAe;QAChD,MAAM,GAAG,CAAC;QACV,WAAW,IAAI,CAAC;IACpB;IAEA,uEAAuE;IACvE,+CAA+C;IAC/C,uEAAuE;IACvE,kEAAkE;IAClE,MAAM,mBAAoC,EAAE;IAC5C,MAAM,qBAAqB,IAAI,sKAAoB;IACnD,MAAM,qBAAqB,IAAI,0KAAwB,CAAC;QACpD,OAAO;QACP,UAAU;QACV,SAAS;QACT,WAAW;QACX,aAAa;QACb,SAAS;IACb;IACA,MAAM,iBAAiB,IAAI,4JAAU,CAAC,oBAAoB;IAC1D,MAAM,GAAG,CAAC;IAEV,4DAA4D;IAC5D,MAAM,oBAAqF,EAAE;IAE7F,SAAS,iBAAiB,IAAY,EAAE,QAAgB,QAAQ;QAC5D,MAAM,SAAS,SAAS,aAAa,CAAC;QACtC,MAAM,UAAU,OAAO,UAAU,CAAC;QAClC,OAAO,KAAK,GAAG;QACf,OAAO,MAAM,GAAG;QAChB,QAAQ,IAAI,GAAG;QACf,QAAQ,SAAS,GAAG,CAAC,CAAC,EAAE,MAAM,QAAQ,CAAC,IAAI,QAAQ,CAAC,GAAG,MAAM;QAC7D,QAAQ,SAAS,GAAG;QACpB,QAAQ,YAAY,GAAG;QACvB,QAAQ,QAAQ,CAAC,MAAM,KAAK;QAE5B,MAAM,UAAU,IAAI,qKAAmB,CAAC;QACxC,MAAM,iBAAiB,IAAI,sKAAoB,CAAC;YAAE,KAAK;YAAS,aAAa;QAAK;QAClF,MAAM,SAAS,IAAI,8JAAY,CAAC;QAChC,OAAO,KAAK,CAAC,GAAG,CAAC,IAAI,IAAI;QACzB,OAAO;IACX;IAEA,4CAA4C;IAC5C,KAAK,MAAM,MAAM,aAAc;QAC3B,MAAM,SAAS,iBAAiB,IAAI;QACpC,OAAO,OAAO,GAAG;QACjB,MAAM,GAAG,CAAC;QACV,kBAAkB,IAAI,CAAC;YAAE,UAAU,GAAG,EAAE;YAAE,MAAM;YAAQ,aAAa;QAAE;IAC3E;IAEA,IAAI,uBAAuB;IAC3B,MAAM,2BAA2B,KAAK,qBAAqB;IAE3D,SAAS;QACL,MAAM,MAAM,YAAY,GAAG;QAC3B,IAAI,MAAM,uBAAuB,0BAA0B;QAC3D,uBAAuB;QAEvB,4CAA4C;QAC5C,MAAM,kBAAkB,IAAA,uIAAW,EAAC;QACpC,MAAM,aAAa,gBAAgB,SAAS,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;QAC3D,IAAI,aAAa,GAAG;QAEpB,oDAAoD;QACpD,MAAM,iBAAiB,IAAI,UAAU;QACrC,MAAM,kBAAkB,KAAK,mBAAmB;QAChD,MAAM,KAAK,iBAAiB;QAE5B,iBAAiB,MAAM,GAAG;QAC1B,iBAAiB,IAAI,CAAC,IAAI,+JAAa,CACnC,eAAe,CAAC,WAAW,CAAC,QAAQ,CAAC,EAAE,EACvC,eAAe,CAAC,WAAW,CAAC,QAAQ,CAAC,EAAE,EACvC,eAAe,CAAC,WAAW,CAAC,QAAQ,CAAC,EAAE;QAG3C,8BAA8B;QAC9B,KAAK,MAAM,aAAa,kBAAmB;YACvC,UAAU,WAAW,GAAG;QAC5B;QAEA,MAAM,OAAO,SAAS,KAAK;QAC3B,IAAI,cAAc;QAElB,6BAA6B;QAC7B,IAAK,IAAI,IAAI,GAAG,IAAI,iBAAiB,IAAK;YACtC,MAAM,EAAE,QAAQ,UAAU,EAAE,MAAM,EAAE,GAAG,IAAA,sIAAU,EAAC,iBAAiB,IAAI,MAAM,aAAa,KAAK;YAC/F,eAAe;YAEf,+DAA+D;YAC/D,IAAK,IAAI,IAAI,GAAG,IAAI,WAAW,MAAM,EAAE,IAAK;gBACxC,eAAe,CAAC,EAAE,GAAG;oBAAE,GAAG,UAAU,CAAC,EAAE;gBAAC;YAC5C;YAEA,uBAAuB;YACvB,MAAM,WAAW,eAAe,CAAC,WAAW,CAAC,QAAQ;YACrD,iBAAiB,IAAI,CAAC,IAAI,+JAAa,CAAC,QAAQ,CAAC,EAAE,EAAE,QAAQ,CAAC,EAAE,EAAE,QAAQ,CAAC,EAAE;YAE7E,gCAAgC;YAChC,IAAI,UAAU,OAAO,QAAQ,IAAI,OAAO,QAAQ,CAAC,MAAM,GAAG,GAAG;gBACzD,KAAK,MAAM,MAAM,OAAO,QAAQ,CAAE;oBAC9B,IAAI,GAAG,OAAO,KAAK,SAAS;wBACxB,MAAM,YAAY,kBAAkB,IAAI,CAAC,CAAA,MAAO,IAAI,QAAQ,KAAK,GAAG,MAAM;wBAC1E,IAAI,WAAW;4BACX,gDAAgD;4BAChD,MAAM,cAAc,KAAK,GAAG,CAAC,GAAG,MAAM,GAAG,KAAK,OAAO;4BACrD,UAAU,WAAW,GAAG,KAAK,GAAG,CAAC,UAAU,WAAW,EAAE;wBAC5D;oBACJ;gBACJ;YACJ;QACJ;QAEA,kCAAkC;QAClC,IAAI,iBAAiB,MAAM,IAAI,GAAG;YAC9B,MAAM,YAAsB,EAAE;YAC9B,KAAK,MAAM,SAAS,iBAAkB;gBAClC,UAAU,IAAI,CAAC,MAAM,CAAC,EAAE,MAAM,CAAC,EAAE,MAAM,CAAC;YAC5C;YACA,mBAAmB,YAAY,CAAC,YAAY,IAAI,8KAA4B,CAAC,WAAW;YACxF,mBAAmB,qBAAqB;YACxC,eAAe,oBAAoB,IAAI,4BAA4B;YACnE,eAAe,OAAO,GAAG;QAC7B,OAAO;YACH,eAAe,OAAO,GAAG;QAC7B;QAEA,4BAA4B;QAC5B,KAAK,MAAM,aAAa,kBAAmB;YACvC,IAAI,UAAU,WAAW,GAAG,GAAG;gBAC3B,MAAM,KAAK,aAAa,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,UAAU,QAAQ;gBAC7D,IAAI,IAAI;oBACJ,kCAAkC;oBAClC,MAAM,aAAa,UAAU,IAAI,CAAC,CAAA,KAAM,GAAG,EAAE,KAAK,UAAU,QAAQ;oBACpE,MAAM,SAAS,aAAa,WAAW,MAAM,GAAG,IAAI;oBACpD,UAAU,IAAI,CAAC,QAAQ,CAAC,GAAG,CACvB,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,EAClB,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,GAAG,QACrB,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC;oBAGtB,mCAAmC;oBACnC,MAAM,kBAAkB,GAAG,KAAK,KAAK,CAAC,UAAU,WAAW,EAAE,CAAC,CAAC;oBAC/D,MAAM,QAAQ,UAAU,WAAW,GAAG,KAAK,WAC7B,UAAU,WAAW,GAAG,KAAK,WAAW;oBAEtD,wBAAwB;oBACxB,MAAM,SAAS,SAAS,aAAa,CAAC;oBACtC,MAAM,UAAU,OAAO,UAAU,CAAC;oBAClC,OAAO,KAAK,GAAG;oBACf,OAAO,MAAM,GAAG;oBAChB,QAAQ,IAAI,GAAG;oBACf,QAAQ,SAAS,GAAG,CAAC,CAAC,EAAE,MAAM,QAAQ,CAAC,IAAI,QAAQ,CAAC,GAAG,MAAM;oBAC7D,QAAQ,SAAS,GAAG;oBACpB,QAAQ,YAAY,GAAG;oBACvB,QAAQ,QAAQ,CAAC,iBAAiB,KAAK;oBAEvC,MAAM,UAAU,IAAI,qKAAmB,CAAC;oBACxC,UAAU,IAAI,CAAC,QAAQ,CAAC,GAAG,GAAG;oBAC9B,UAAU,IAAI,CAAC,QAAQ,CAAC,WAAW,GAAG;oBACtC,UAAU,IAAI,CAAC,OAAO,GAAG;gBAC7B;YACJ,OAAO;gBACH,UAAU,IAAI,CAAC,OAAO,GAAG;YAC7B;QACJ;IACJ;IAEA,mFAAmF;IACnF,MAAM,QAAoB;QACtB,UAAU,MAAM,QAAQ,CAAC,KAAK;QAC9B,UAAU,IAAI,+JAAa,CAAC,UAAU,QAAQ,CAAC,EAAE,EAAE,UAAU,QAAQ,CAAC,EAAE,EAAE,UAAU,QAAQ,CAAC,EAAE;QAC/F,UAAU;QACV,MAAM;QACN,YAAY;QACZ,QAAQ;IACZ;IAEA,gDAAgD;IAChD,yFAAyF;IACzF,CAAC,SAAS;QACN,IAAI,KAAK,GAAG,KAAK,GAAG,KAAK;QACzB,IAAI,YAAY;QAChB,KAAK,MAAM,KAAK,OAAQ;YACpB,MAAM,EAAE,IAAI,GAAG,EAAE,QAAQ,CAAC,EAAE;YAC5B,MAAM,EAAE,IAAI,GAAG,EAAE,QAAQ,CAAC,EAAE;YAC5B,MAAM,EAAE,IAAI,GAAG,EAAE,QAAQ,CAAC,EAAE;YAC5B,aAAa,EAAE,IAAI;QACvB;QACA,IAAI,YAAY,GAAG;YACf,MAAM,KAAK,KAAK;YAChB,MAAM,KAAK,KAAK;YAChB,MAAM,KAAK,KAAK;YAChB,kDAAkD;YAClD,KAAK,MAAM,KAAK,OAAQ;gBACpB,EAAE,QAAQ,CAAC,EAAE,IAAI;gBACjB,EAAE,QAAQ,CAAC,EAAE,IAAI;gBACjB,EAAE,QAAQ,CAAC,EAAE,IAAI;YACrB;YACA,8CAA8C;YAC9C,IAAI;gBACA,SAAS,QAAQ,CAAC,GAAG,CAAC,OAAO,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,QAAS,QAAQ,CAAC,EAAE,EAAE,OAAO,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,QAAS,QAAQ,CAAC,EAAE,EAAE,OAAO,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,QAAS,QAAQ,CAAC,EAAE;gBAC1K,KAAK,MAAM,MAAM,aAAc;oBAC3B,MAAM,IAAI,OAAO,IAAI,CAAC,CAAC,KAAO,GAAG,EAAE,KAAK,GAAG,EAAE;oBAC7C,IAAI,GAAG,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,QAAQ,CAAC,EAAE,EAAE,EAAE,QAAQ,CAAC,EAAE,EAAE,EAAE,QAAQ,CAAC,EAAE;gBAC3E;gBACA,QAAQ;gBACR,MAAM,KAAK,OAAO,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;gBACvC,IAAI,IAAI;oBACJ,MAAM,QAAQ,CAAC,GAAG,CAAC,GAAG,QAAQ,CAAC,EAAE,EAAE,GAAG,QAAQ,CAAC,EAAE,EAAE,GAAG,QAAQ,CAAC,EAAE;oBACjE,MAAM,QAAQ,CAAC,IAAI,CAAC,MAAM,QAAQ;gBACtC;YACJ,EAAE,OAAO,GAAG;YACR,6BAA6B;YACjC;YACA,QAAQ,GAAG,CAAC,8BAA8B,GAAG,OAAO,CAAC,IAAI,GAAG,OAAO,CAAC,IAAI,GAAG,OAAO,CAAC;QACvF;IACJ,CAAC;IAED,SAAS;QACL,OAAO,MAAM,GAAG,OAAO,UAAU,GAAG,OAAO,WAAW;QACtD,OAAO,sBAAsB;QAC7B,SAAS,OAAO,CAAC,OAAO,UAAU,EAAE,OAAO,WAAW;QACtD,SAAS,aAAa,CAAC,KAAK,GAAG,CAAC,OAAO,gBAAgB,IAAI,GAAG;IAClE;IAEA,OAAO,gBAAgB,CAAC,UAAU;IAElC,IAAI,UAAU;IAEd,+CAA+C;IAC/C,wFAAwF;IACxF,oFAAoF;IACpF,MAAM,eAAe;QACjB,qBAAqB;QACrB,iBAAiB;QACjB,QAAQ,IAAoB,sCAAsC;IACtE;IAEA,4CAA4C;IAC5C,MAAM,eAA6B,EAAE;IAErC,SAAS,eAAe,EAAU;QAC9B,iDAAiD;QACjD,MAAM,OAAO,SAAS,KAAK;QAC3B,MAAM,EAAE,QAAQ,UAAU,EAAE,MAAM,EAAE,GAAG,IAAA,sIAAU,EAAC,QAAQ,IAAI,MAAM,SAAS,KAAK;QAClF,WAAW;QAEX,oDAAoD;QACpD,KAAK,MAAM,MAAM,WAAY;YACrB,MAAM,MAAM,OAAO,SAAS,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,GAAG,EAAE;YAClD,sFAAsF;YACtF,MAAM,OAAO,OAAO,IAAI,MAAM,CAAC,IAAI,GAAG;YACtC,IAAI,OAAO,KAAK,CAAC,MAAM,UAAU;gBAC7B,MAAM,CAAC,IAAI,GAAG;YAClB;YACJ,gBAAgB;YAChB,IAAI,GAAG,EAAE,KAAK,SAAS;gBACnB,MAAM,QAAQ,CAAC,GAAG,CAAC,GAAG,QAAQ,CAAC,EAAE,EAAE,GAAG,QAAQ,CAAC,EAAE,EAAE,GAAG,QAAQ,CAAC,EAAE;gBACjE,MAAM,QAAQ,CAAC,IAAI,CAAC,MAAM,QAAQ;gBAClC,MAAM,QAAQ,CAAC,GAAG,CAAC,GAAG,QAAQ,CAAC,EAAE,EAAE,GAAG,QAAQ,CAAC,EAAE,EAAE,GAAG,QAAQ,CAAC,EAAE;gBACjE,8CAA8C;gBAC9C,MAAM,QAAQ,IAAI,OAAO;oBAAC,GAAG,QAAQ,CAAC,EAAE,GAAG;oBAAI,GAAG,QAAQ,CAAC,EAAE,GAAG;oBAAI,GAAG,QAAQ,CAAC,EAAE,GAAG;iBAAG;gBACxF,iDAAiD;gBACjD,IAAI,MAAM,IAAI,IAAI,GAAG;oBACjB,MAAM,MAAM,GAAG;gBACnB,OAAO;oBACH,MAAM,MAAM,GAAG,MAAM,QAAQ,CAAC,MAAM,KAAK,OAAO,YAAY;gBAChE;gBAEA,mDAAmD;gBACnD,MAAM,QAAQ,MAAM,QAAQ,CAAC,MAAM;gBACnC,IAAI,QAAQ,KAAK;oBACb,kDAAkD;oBAClD,MAAM,YAAY,MAAM,QAAQ,CAAC,KAAK,GAAG,SAAS;oBAElD,uDAAuD;oBACvD,iFAAiF;oBACjF,MAAM,eAAe,IAAI,+JAAa;oBACtC,aAAa,MAAM,CACf,IAAI,+JAAa,CAAC,GAAG,GAAG,IACxB,UAAU,MAAM,IAChB,IAAI,+JAAa,CAAC,GAAG,GAAG,GAAK,YAAY;;oBAG7C,wCAAwC;oBACxC,MAAM,mBAAmB,IAAI,kKAAgB;oBAC7C,iBAAiB,qBAAqB,CAAC;oBAEvC,+DAA+D;oBAC/D,0DAA0D;oBAC1D,MAAM,gBAAgB,MAAM,gBAAgB;oBAC5C,MAAM,UAAU,CAAC,KAAK,CAAC,kBAAkB;gBAC7C;YACJ;YACA,0EAA0E;YAC1E,MAAM,KAAK,aAAa,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,GAAG,EAAE;YAClD,IAAI,IAAI;gBACJ,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,GAAG,QAAQ,CAAC,EAAE,EAAE,GAAG,QAAQ,CAAC,EAAE,EAAE,GAAG,QAAQ,CAAC,EAAE;gBACnE,iDAAiD;gBACjD,IAAI,AAAC,GAAW,aAAa,EAAE;oBAC1B,GAAW,aAAa,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,QAAQ;gBAC5D;YACJ;YACA,wEAAwE;YACxE,IAAI,GAAG,EAAE,KAAK,QAAQ;gBAClB,SAAS,QAAQ,CAAC,GAAG,CAAC,GAAG,QAAQ,CAAC,EAAE,EAAE,GAAG,QAAQ,CAAC,EAAE,EAAE,GAAG,QAAQ,CAAC,EAAE;YACxE;QACJ;QAEA,sCAAsC;QACtC;QAEA,wCAAwC;QACxC;QAEA,sCAAsC;QACtC;QAEA,4BAA4B;QAC5B,IAAI,UAAU,OAAO,QAAQ,IAAI,OAAO,QAAQ,CAAC,MAAM,EAAE;YACrD,KAAK,MAAM,MAAM,OAAO,QAAQ,CAAE;gBAC9B,IAAI,GAAG,OAAO,KAAK,SAAS;oBACxB,MAAM,UAAU,IAAI;oBACpB,QAAQ,GAAG,CAAC,CAAC,uBAAuB,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,eAAe,EAAE,GAAG,MAAM,CAAC,QAAQ,EAAE,GAAG,MAAM,CAAC,OAAO,CAAC,IAAI;oBACpH,gCAAgC;oBAChC,MAAM,OAAO,WAAW,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,GAAG,MAAM;oBACtD,IAAI,MAAM;wBACN,MAAM,aAAa,IAAI,sKAAoB,CAAC,KAAK,GAAG;wBACpD,MAAM,YAAY,IAAI,yKAAuB,CAAC;4BAAE,OAAO;wBAAS;wBAChE,MAAM,SAAS,IAAI,4JAAU,CAAC,YAAY;wBAC1C,OAAO,QAAQ,CAAC,GAAG,CAAC,KAAK,QAAQ,CAAC,EAAE,EAAE,KAAK,QAAQ,CAAC,EAAE,EAAE,KAAK,QAAQ,CAAC,EAAE;wBACxE,MAAM,GAAG,CAAC;wBACV,aAAa,IAAI,CAAC;wBAClB,6BAA6B;wBAC7B,WAAW;4BACP,MAAM,MAAM,CAAC;4BACb,MAAM,IAAI,aAAa,OAAO,CAAC;4BAC/B,IAAI,KAAK,GAAG,aAAa,MAAM,CAAC,GAAG;wBACvC,GAAG;oBACP;oBACA,gDAAgD;oBAChD,IAAI;wBACA,MAAM,WAAgB,MAAM,QAAQ,CAAC,EAAE,EAAE,2BAA2B;wBACpE,MAAM,MAAW,UAAU;wBAC3B,IAAI,OAAO,IAAI,QAAQ,EAAE;4BACrB,MAAM,OAAO,IAAI,QAAQ,CAAC,KAAK,GAAG,IAAI,QAAQ,CAAC,KAAK,KAAK;4BACzD,IAAI,QAAQ,CAAC,MAAM,CAAC;4BACpB,WAAW;gCACP,IAAI,QAAQ,IAAI,QAAQ,IAAI,IAAI,QAAQ,CAAC,GAAG,EAAE,IAAI,QAAQ,CAAC,IAAI,CAAC;4BACpE,GAAG;wBACP;oBACJ,EAAE,OAAO,GAAG;oBACR,yBAAyB;oBAC7B;gBACJ;YACJ;QACJ;IACJ;IAEA,wEAAwE;IACxE,CAAC,SAAS;QACN,MAAM,MAAM,CAAC;YACT,MAAM,MAAM,OAAO,SAAS,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;YAC7C,IAAI,OAAO,GAAG;gBACV,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE;gBAChC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE;gBAChC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE;YACpC;QACJ;QACA,IAAI;YACA,uEAAuE;YACtE,OAAe,oBAAoB,GAAG;QAC3C,EAAE,OAAO,GAAG;QACR,mCAAmC;QACvC;IACJ,CAAC;IAED,uEAAuE;IACvE,oCAAoC;IACpC,uEAAuE;IACvE,SAAS;QACL,IAAI,CAAC,gBAAgB,OAAO,EAAE;QAE9B,MAAM,YAAY,oBAAoB,UAAU,CAAC,QAAQ,CAAC,KAAK;QAC/D,MAAM,OAAO,SAAS,KAAK;QAC3B,MAAM,aAAa,IAAI,yDAAyD;QAEhF,8BAA8B;QAC9B,IAAK,IAAI,IAAI,GAAG,IAAI,UAAU,MAAM,EAAE,IAAK;YACvC,SAAS,CAAC,EAAE,GAAG,iBAAiB,CAAC,EAAE;QACvC;QAEA,kEAAkE;QAClE,MAAM,WAAW,WAAW;QAC5B,MAAM,kBAAkB;YACpB;gBAAC;gBAAU;aAAS;YACpB;gBAAC;gBAAU,CAAC;aAAS;YACrB;gBAAC,CAAC;gBAAU;aAAS;YACrB;gBAAC,CAAC;gBAAU,CAAC;aAAS;SACzB;QAED,IAAI,qBAAqB;QACzB,KAAK,MAAM,CAAC,IAAI,GAAG,IAAI,gBAAiB;YACpC,IAAI,kBAAkB;YACtB,KAAK,MAAM,QAAQ,OAAQ;gBACvB,IAAI,KAAK,OAAO,EAAE;gBAClB,MAAM,KAAK,KAAK,KAAK,QAAQ,CAAC,EAAE;gBAChC,MAAM,KAAK,KAAK,KAAK,QAAQ,CAAC,EAAE;gBAChC,MAAM,WAAW,KAAK,IAAI,CAAC,KAAK,KAAK,KAAK;gBAC1C,IAAI,WAAW,KAAK;oBAChB,mBAAmB,CAAC,CAAC,OAAO,KAAK,IAAI,IAAI;gBAC7C;YACJ;YACA,sBAAsB;QAC1B;QACA,sBAAsB,gBAAgB,MAAM,EAAE,UAAU;QAExD,kDAAkD;QAClD,IAAK,IAAI,IAAI,GAAG,IAAI,UAAU,MAAM,EAAE,KAAK,EAAG;YAC1C,MAAM,IAAI,SAAS,CAAC,EAAE;YACtB,MAAM,IAAI,SAAS,CAAC,IAAI,EAAE;YAC1B,IAAI,iBAAiB;YAErB,4DAA4D;YAC5D,KAAK,MAAM,QAAQ,OAAQ;gBACvB,IAAI,KAAK,OAAO,EAAE,UAAU,+BAA+B;gBAE3D,MAAM,KAAK,IAAI,KAAK,QAAQ,CAAC,EAAE;gBAC/B,MAAM,KAAK,IAAI,KAAK,QAAQ,CAAC,EAAE;gBAC/B,MAAM,WAAW,KAAK,IAAI,CAAC,KAAK,KAAK,KAAK;gBAE1C,IAAI,WAAW,KAAK;oBAChB,4DAA4D;oBAC5D,MAAM,YAAY,CAAC,CAAC,OAAO,KAAK,IAAI,IAAI;oBACxC,kBAAkB;gBACtB;YACJ;YAEA,wDAAwD;YACxD,MAAM,gBAAgB,iBAAiB;YACvC,SAAS,CAAC,IAAI,EAAE,GAAG,gBAAgB;QACvC;QAEA,oBAAoB,UAAU,CAAC,QAAQ,CAAC,WAAW,GAAG;QACtD,oBAAoB,oBAAoB,IAAI,qCAAqC;IACrF;IAEA,iCAAiC;IACjC,SAAS,kBAAkB,OAAgB;QACvC,gBAAgB,OAAO,GAAG;QAC1B,KAAK,OAAO,GAAG,CAAC;QAChB,IAAI,SAAS;YACT;QACJ;IACJ;IAEA,SAAS;QACL,OAAO,mBAAmB,CAAC,UAAU;QACrC,SAAS,OAAO;QAChB,MAAM,QAAQ,CAAC,CAAC;YACZ,IAAI,IAAI,QAAQ,EAAE,IAAI,QAAQ,CAAC,OAAO;YACtC,IAAI,IAAI,QAAQ,EAAE;gBACd,MAAM,MAAM,IAAI,QAAQ;gBACxB,IAAI,MAAM,OAAO,CAAC,MAAM,IAAI,OAAO,CAAC,CAAC,IAAM,EAAE,OAAO,IAAI,EAAE,OAAO;qBAC5D,IAAI,OAAO,IAAI,IAAI,OAAO;YACnC;QACJ;IACJ;IAEA,OAAO;QAAE;QAAO;QAAQ;QAAU;QAAS;QAAO;QAAO;QAAU;QAAe;QAAgB;IAAkB;AACxH;AAMO,SAAS,mBAAmB,GAA6B;IAC5D,0EAA0E;IAC1E,QAAQ,IAAI,CAAC;AACjB;AAEA,oDAAoD;AACpD,SAAS,OAAO,CAA2B;IACvC,OAAO,KAAK,IAAI,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE;AAC5D;uCAEe","debugId":null}},
    {"offset": {"line": 1223, "column": 0}, "map": {"version":3,"sources":["file:///D:/my_projects/space-probe-game-next/src/components/GameCanvas.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useRef } from 'react';\nimport { initThreeJS, PHYSICS_SCALE } from '../lib/threeSetup';\nimport { CameraView } from './Controls';\n\ntype HUDSetters = {\n    setStatus: React.Dispatch<React.SetStateAction<string>>;\n    setVelocity: (value: number) => void;\n    setDistance: (value: number) => void;\n    setFuel: React.Dispatch<React.SetStateAction<number>>;\n    setSlingshots: React.Dispatch<React.SetStateAction<number>>;\n};\n\ninterface Props {\n    hudSetters?: HUDSetters;\n    probeSpeedMult?: number;\n    gravityG?: number;\n    starMass?: number;\n    cameraView?: CameraView;\n    gravityGridEnabled?: boolean;\n}\n\nconst GameCanvas: React.FC<Props> = ({ hudSetters, probeSpeedMult = 1.05, gravityG = 1.0, starMass = 4000, cameraView = 'free', gravityGridEnabled = false }) => {\n    const canvasRef = useRef<HTMLCanvasElement | null>(null);\n    const rafRef = useRef<number | null>(null);\n    const cameraViewRef = useRef<CameraView>(cameraView);\n\n    // Update cameraViewRef when cameraView changes\n    useEffect(() => {\n        cameraViewRef.current = cameraView;\n    }, [cameraView]);\n\n    // Update gravity grid when gravityGridEnabled changes\n    const gravityGridRef = useRef<any>(null);\n    useEffect(() => {\n        if (gravityGridRef.current && gravityGridRef.current.updateGravityGrid) {\n            gravityGridRef.current.updateGravityGrid(gravityGridEnabled);\n        }\n    }, [gravityGridEnabled]);\n\n    useEffect(() => {\n        const canvas = canvasRef.current;\n        if (!canvas) return;\n    const hudUpdateRef = { current: undefined as any } as React.MutableRefObject<any>;\n    const trailRef = { current: undefined as any } as React.MutableRefObject<any>;\n\n    // pass simulation tuning options to initThreeJS\n    let threeObj: any = (initThreeJS as any)(canvas, { probeSpeedMult, G: gravityG, starMass, gravityGridEnabled });\n    let { scene, camera, renderer, dispose, state, probe, controls, addTrailPoint, stepSimulation, updateGravityGrid } = threeObj;\n    gravityGridRef.current = { updateGravityGrid };\n\n    // input state\n    const inputState = { left: false, right: false, up: false, down: false } as any;\n\n    const onKeyDown = (e: KeyboardEvent) => {\n        if (e.key === 'ArrowLeft') inputState.left = true;\n        if (e.key === 'ArrowRight') inputState.right = true;\n        if (e.key === 'ArrowUp') inputState.up = true;\n        if (e.key === 'ArrowDown') inputState.down = true;\n        if (e.key === 'r' || e.key === 'R') {\n            // restart: dispose and reinit\n            try {\n                if (rafRef.current) cancelAnimationFrame(rafRef.current);\n            } catch (e) {}\n            try {\n                dispose();\n            } catch (e) {}\n            threeObj = (initThreeJS as any)(canvas, { probeSpeedMult, G: gravityG, starMass, gravityGridEnabled });\n            ({ scene, camera, renderer, dispose, state, probe, controls, addTrailPoint, stepSimulation, updateGravityGrid } = threeObj);\n            // Restart animation loop\n            lastTime = performance.now() / 1000;\n            accumulator = 0;\n            rafRef.current = requestAnimationFrame(animate);\n        }\n    };\n\n    const onKeyUp = (e: KeyboardEvent) => {\n        if (e.key === 'ArrowLeft') inputState.left = false;\n        if (e.key === 'ArrowRight') inputState.right = false;\n        if (e.key === 'ArrowUp') inputState.up = false;\n        if (e.key === 'ArrowDown') inputState.down = false;\n    };\n\n    window.addEventListener('keydown', onKeyDown);\n    window.addEventListener('keyup', onKeyUp);\n\n        // Fixed timestep physics loop (e.g., 60 Hz)\n        const fixedTimeStep = 1 / 60; // seconds\n        let accumulator = 0;\n        let lastTime = performance.now() / 1000;\n\n        const animate = () => {\n            const now = performance.now() / 1000;\n            let delta = now - lastTime;\n            lastTime = now;\n\n            // clamp delta to avoid spiral of death\n            if (delta > 0.25) delta = 0.25;\n\n            accumulator += delta;\n            while (accumulator >= fixedTimeStep) {\n                try {\n                    // apply input-driven delta-v before stepping\n                    const dvScale = 0.02; // tune this for feel (scene-units/sec)\n                    let dv: [number, number, number] = [0, 0, 0];\n\n                    // Calculate thrust direction based on current velocity (velocity-relative control)\n                    if (state && state.velocity) {\n                        const vx = state.velocity.x;\n                        const vy = state.velocity.y;\n                        const vz = state.velocity.z;\n                        const speed = Math.sqrt(vx * vx + vy * vy + vz * vz);\n\n                        if (speed > 0.001) {\n                            // Normalize velocity to get forward direction\n                            const fx = vx / speed;\n                            const fy = vy / speed;\n                            const fz = vz / speed;\n\n                            // Calculate right direction (cross product with up vector [0,1,0])\n                            // right = cross(forward, up) = [fz, 0, -fx]\n                            const rx = fz;\n                            const ry = 0;\n                            const rz = -fx;\n\n                            // Normalize right vector\n                            const rLen = Math.sqrt(rx * rx + rz * rz);\n                            const rnx = rLen > 0.001 ? rx / rLen : 1;\n                            const rnz = rLen > 0.001 ? rz / rLen : 0;\n\n                            // Apply thrust based on input\n                            if (inputState.left) {\n                                // Thrust to the left (opposite of right direction)\n                                dv[0] += rnx * dvScale;\n                                dv[2] += rnz * dvScale;\n                            }\n                            if (inputState.right) {\n                                // Thrust to the right\n                                dv[0] -= rnx * dvScale;\n                                dv[2] -= rnz * dvScale;\n                            }\n                            if (inputState.up) {\n                                // Thrust forward (in velocity direction)\n                                dv[0] += fx * dvScale;\n                                dv[2] += fz * dvScale;\n                            }\n                            if (inputState.down) {\n                                // Thrust backward (brake)\n                                dv[0] -= fx * dvScale;\n                                dv[2] -= fz * dvScale;\n                            }\n                        } else {\n                            // Fallback to world-axis control when stationary\n                            if (inputState.left) dv[0] -= dvScale;\n                            if (inputState.right) dv[0] += dvScale;\n                            if (inputState.up) dv[2] -= dvScale;\n                            if (inputState.down) dv[2] += dvScale;\n                        }\n                    }\n\n                    if (dv[0] !== 0 || dv[1] !== 0 || dv[2] !== 0) {\n                        // Calculate fuel consumption based on delta-v magnitude\n                        const dvMagnitude = Math.sqrt(dv[0] * dv[0] + dv[1] * dv[1] + dv[2] * dv[2]);\n                        const fuelConsumed = dvMagnitude * PHYSICS_SCALE.FUEL_CONSUMPTION_RATE;\n\n                        // Check if enough fuel available\n                        if (state.fuel > 0) {\n                            // Consume fuel\n                            state.fuel = Math.max(0, state.fuel - fuelConsumed);\n\n                            // Apply thrust\n                            try {\n                                // call exported helper bound in threeSetup\n                                (window as any).__applyDeltaVToProbe ? (window as any).__applyDeltaVToProbe(dv) : (initThreeJS as any).applyDeltaVToProbe?.(dv);\n                            } catch (e) {\n                                try { (initThreeJS as any).applyDeltaVToProbe?.(dv); } catch (e) {}\n                            }\n                        }\n                        // If fuel depleted, thrust is not applied (status will be set in stepSimulation)\n                    }\n                    stepSimulation(fixedTimeStep);\n                } catch (e) {\n                    // swallow physics errors to keep render loop alive\n                    console.error('physics step error', e);\n                }\n                accumulator -= fixedTimeStep;\n            }\n\n            // synchronize visual probe mesh with simulated state\n            try {\n                if (probe && state.position) probe.position.copy(state.position);\n            } catch (e) {\n                // ignore copy errors in unusual cases\n            }\n\n            // update camera position based on view mode\n            try {\n                if (cameraViewRef.current === 'top') {\n                    // Top view: camera above the sun\n                    camera.position.set(0, 1500, 0);\n                    camera.lookAt(0, 0, 0);\n                    controls.enabled = false;\n                } else if (cameraViewRef.current === 'probe') {\n                    // Probe follow view: camera behind and above the probe\n                    if (probe && state.position) {\n                        const probePos = state.position;\n                        const vel = state.velocity;\n                        const speed = vel ? vel.length() : 0;\n\n                        if (speed > 0.1) {\n                            // Position camera behind the probe based on velocity direction\n                            const velNorm = vel.clone().normalize();\n                            const camOffset = velNorm.multiplyScalar(-150); // 150 units behind\n                            const camPos = probePos.clone().add(camOffset);\n                            camPos.y += 80; // 80 units above\n\n                            camera.position.copy(camPos);\n                            camera.lookAt(probePos.x, probePos.y, probePos.z);\n                        } else {\n                            // If probe is stationary, use fixed offset\n                            camera.position.set(probePos.x, probePos.y + 80, probePos.z + 150);\n                            camera.lookAt(probePos.x, probePos.y, probePos.z);\n                        }\n                    }\n                    controls.enabled = false;\n                } else {\n                    // Free view: enable orbit controls\n                    controls.enabled = true;\n                    controls.update();\n                }\n            } catch (e) {\n                // ignore camera update errors\n            }\n\n            // add trail point periodically (every 100ms)\n            if (addTrailPoint) {\n                const nowMsPoint = performance.now();\n                if (!trailRef.current) trailRef.current = { lastMs: nowMsPoint };\n                if (nowMsPoint - trailRef.current.lastMs > 100) {\n                    try {\n                        addTrailPoint(state.position);\n                    } catch (e) {\n                        // ignore\n                    }\n                    trailRef.current.lastMs = nowMsPoint;\n                }\n            }\n\n                // update HUD if setters provided (throttled)\n                if (hudSetters) {\n                    const nowMs = performance.now();\n                    const lastMs = (hudUpdateRef.current && hudUpdateRef.current.lastMs) || 0;\n                    const lastVals = (hudUpdateRef.current && hudUpdateRef.current.lastVals) || { velocity: -1, distance: -1, fuel: -1, slingshots: -1, status: '' };\n\n                    const speed = state.velocity ? state.velocity.length() : 0;\n                    const speedKmPerSec = speed * PHYSICS_SCALE.VELOCITY_TO_KM_PER_SEC;\n                    const shouldUpdateTime = nowMs - lastMs > 200; // 200ms throttle\n                    const largeChange = Math.abs(speedKmPerSec - lastVals.velocity) > 0.7 || Math.abs(state.distance - lastVals.distance) > 0.1 || Math.abs(state.fuel - lastVals.fuel) > 1 || state.slingshots !== lastVals.slingshots || state.status !== lastVals.status;\n\n                    if (shouldUpdateTime || largeChange) {\n                        hudSetters.setVelocity(speedKmPerSec);\n                        hudSetters.setDistance(state.distance);\n                        hudSetters.setFuel(state.fuel);\n                        hudSetters.setSlingshots(state.slingshots);\n                        hudSetters.setStatus(state.status);\n\n                        hudUpdateRef.current = { lastMs: nowMs, lastVals: { velocity: speedKmPerSec, distance: state.distance, fuel: state.fuel, slingshots: state.slingshots, status: state.status } };\n                    }\n                }\n\n            renderer.render(scene, camera);\n            rafRef.current = requestAnimationFrame(animate);\n        };\n\n        rafRef.current = requestAnimationFrame(animate);\n\n        return () => {\n            if (rafRef.current) cancelAnimationFrame(rafRef.current);\n            dispose();\n            window.removeEventListener('keydown', onKeyDown);\n            window.removeEventListener('keyup', onKeyUp);\n        };\n    }, [hudSetters, probeSpeedMult, gravityG, starMass]);\n\n    return <canvas ref={canvasRef} style={{ display: 'block', width: '100vw', height: '100vh' }} />;\n};\n\nexport default GameCanvas;"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1557, "column": 0}, "map": {"version":3,"sources":["file:///D:/my_projects/space-probe-game-next/src/components/MiniChart.tsx"],"sourcesContent":["import React, { useRef, useEffect } from 'react';\nimport { DataPoint } from '../app/page';\n\ninterface MiniChartProps {\n    data: DataPoint[];\n    color: string;\n    label: string;\n    unit: string;\n    width?: number;\n    height?: number;\n}\n\nconst MiniChart: React.FC<MiniChartProps> = ({\n    data,\n    color,\n    label,\n    unit,\n    width = 250,\n    height = 80,\n}) => {\n    const canvasRef = useRef<HTMLCanvasElement>(null);\n\n    useEffect(() => {\n        const canvas = canvasRef.current;\n        if (!canvas || data.length < 2) return;\n\n        const ctx = canvas.getContext('2d');\n        if (!ctx) return;\n\n        // Clear canvas\n        ctx.clearRect(0, 0, width, height);\n\n        // Get min/max values for scaling\n        const values = data.map(d => d.value);\n        const maxValue = Math.max(...values);\n        const minValue = Math.min(...values);\n        const valueRange = maxValue - minValue || 1;\n\n        const times = data.map(d => d.time);\n        const minTime = Math.min(...times);\n        const maxTime = Math.max(...times);\n        const timeRange = maxTime - minTime || 1;\n\n        // Draw grid lines\n        ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';\n        ctx.lineWidth = 1;\n        for (let i = 0; i <= 4; i++) {\n            const y = (height / 4) * i;\n            ctx.beginPath();\n            ctx.moveTo(0, y);\n            ctx.lineTo(width, y);\n            ctx.stroke();\n        }\n\n        // Draw the line\n        ctx.strokeStyle = color;\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n\n        data.forEach((point, index) => {\n            const x = ((point.time - minTime) / timeRange) * width;\n            const y = height - ((point.value - minValue) / valueRange) * height;\n\n            if (index === 0) {\n                ctx.moveTo(x, y);\n            } else {\n                ctx.lineTo(x, y);\n            }\n        });\n\n        ctx.stroke();\n\n        // Draw current value indicator\n        if (data.length > 0) {\n            const lastPoint = data[data.length - 1];\n            const x = width;\n            const y = height - ((lastPoint.value - minValue) / valueRange) * height;\n\n            ctx.fillStyle = color;\n            ctx.beginPath();\n            ctx.arc(x - 2, y, 3, 0, Math.PI * 2);\n            ctx.fill();\n        }\n    }, [data, color, width, height]);\n\n    // Get current, min, max values\n    const currentValue = data.length > 0 ? data[data.length - 1].value : 0;\n    const maxValue = data.length > 0 ? Math.max(...data.map(d => d.value)) : 0;\n    const minValue = data.length > 0 ? Math.min(...data.map(d => d.value)) : 0;\n\n    return (\n        <div className=\"mini-chart\">\n            <div className=\"chart-header\">\n                <span className=\"chart-label\">{label}</span>\n                <span className=\"chart-current\" style={{ color }}>\n                    {currentValue.toFixed(2)} {unit}\n                </span>\n            </div>\n            <canvas ref={canvasRef} width={width} height={height} />\n            <div className=\"chart-stats\">\n                <span className=\"stat-min\">Min: {minValue.toFixed(2)}</span>\n                <span className=\"stat-max\">Max: {maxValue.toFixed(2)}</span>\n            </div>\n        </div>\n    );\n};\n\nexport default MiniChart;\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1731, "column": 0}, "map": {"version":3,"sources":["file:///D:/my_projects/space-probe-game-next/src/components/MissionProgress.tsx"],"sourcesContent":["import React from 'react';\n\ninterface Mission {\n    id: string;\n    title: string;\n    description: string;\n    target: number;\n    current: number;\n    unit: string;\n    completed: boolean;\n}\n\ninterface MissionProgressProps {\n    distance: number;\n    velocity: number;\n    slingshots: number;\n    fuel: number;\n}\n\nconst MissionProgress: React.FC<MissionProgressProps> = ({\n    distance,\n    velocity,\n    slingshots,\n    fuel,\n}) => {\n    const missions: Mission[] = [\n        {\n            id: 'reach-1au',\n            title: '1 AU到達',\n            description: '地球の公転軌道半径に到達',\n            target: 1,\n            current: distance,\n            unit: 'AU',\n            completed: distance >= 1,\n        },\n        {\n            id: 'reach-5au',\n            title: '5 AU到達',\n            description: '木星軌道付近に到達',\n            target: 5,\n            current: distance,\n            unit: 'AU',\n            completed: distance >= 5,\n        },\n        {\n            id: 'speed-20',\n            title: '高速飛行',\n            description: '20 km/s以上の速度を達成',\n            target: 20,\n            current: velocity,\n            unit: 'km/s',\n            completed: velocity >= 20,\n        },\n        {\n            id: 'slingshot-3',\n            title: 'スイングバイマスター',\n            description: '3回以上のスイングバイ実行',\n            target: 3,\n            current: slingshots,\n            unit: '回',\n            completed: slingshots >= 3,\n        },\n        {\n            id: 'fuel-efficient',\n            title: '燃料節約',\n            description: '燃料50%以上残して5 AU到達',\n            target: 5,\n            current: distance,\n            unit: 'AU',\n            completed: distance >= 5 && fuel >= 50,\n        },\n    ];\n\n    const completedCount = missions.filter(m => m.completed).length;\n    const totalMissions = missions.length;\n    const completionPercentage = (completedCount / totalMissions) * 100;\n\n    return (\n        <div className=\"mission-progress\">\n            <div className=\"mission-header\">\n                <h3>ミッション進捗</h3>\n                <div className=\"overall-progress\">\n                    <span className=\"progress-text\">\n                        {completedCount} / {totalMissions} 完了\n                    </span>\n                    <div className=\"progress-bar-container\">\n                        <div\n                            className=\"progress-bar-fill\"\n                            style={{ width: `${completionPercentage}%` }}\n                        />\n                    </div>\n                </div>\n            </div>\n            <div className=\"mission-list\">\n                {missions.map(mission => {\n                    const progress = Math.min((mission.current / mission.target) * 100, 100);\n                    return (\n                        <div\n                            key={mission.id}\n                            className={`mission-item ${mission.completed ? 'completed' : ''}`}\n                        >\n                            <div className=\"mission-info\">\n                                <div className=\"mission-title\">\n                                    {mission.completed && <span className=\"checkmark\">✓</span>}\n                                    {mission.title}\n                                </div>\n                                <div className=\"mission-description\">{mission.description}</div>\n                            </div>\n                            <div className=\"mission-status\">\n                                <span className=\"mission-value\">\n                                    {mission.current.toFixed(1)} / {mission.target} {mission.unit}\n                                </span>\n                                <div className=\"mission-progress-bar\">\n                                    <div\n                                        className=\"mission-progress-fill\"\n                                        style={{ width: `${progress}%` }}\n                                    />\n                                </div>\n                            </div>\n                        </div>\n                    );\n                })}\n            </div>\n        </div>\n    );\n};\n\nexport default MissionProgress;\n"],"names":[],"mappings":";;;;;;AAmBA,MAAM,kBAAkD,CAAC,EACrD,QAAQ,EACR,QAAQ,EACR,UAAU,EACV,IAAI,EACP;IACG,MAAM,WAAsB;QACxB;YACI,IAAI;YACJ,OAAO;YACP,aAAa;YACb,QAAQ;YACR,SAAS;YACT,MAAM;YACN,WAAW,YAAY;QAC3B;QACA;YACI,IAAI;YACJ,OAAO;YACP,aAAa;YACb,QAAQ;YACR,SAAS;YACT,MAAM;YACN,WAAW,YAAY;QAC3B;QACA;YACI,IAAI;YACJ,OAAO;YACP,aAAa;YACb,QAAQ;YACR,SAAS;YACT,MAAM;YACN,WAAW,YAAY;QAC3B;QACA;YACI,IAAI;YACJ,OAAO;YACP,aAAa;YACb,QAAQ;YACR,SAAS;YACT,MAAM;YACN,WAAW,cAAc;QAC7B;QACA;YACI,IAAI;YACJ,OAAO;YACP,aAAa;YACb,QAAQ;YACR,SAAS;YACT,MAAM;YACN,WAAW,YAAY,KAAK,QAAQ;QACxC;KACH;IAED,MAAM,iBAAiB,SAAS,MAAM,CAAC,CAAA,IAAK,EAAE,SAAS,EAAE,MAAM;IAC/D,MAAM,gBAAgB,SAAS,MAAM;IACrC,MAAM,uBAAuB,AAAC,iBAAiB,gBAAiB;IAEhE,qBACI,6LAAC;QAAI,WAAU;;0BACX,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;kCAAG;;;;;;kCACJ,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;gCAAK,WAAU;;oCACX;oCAAe;oCAAI;oCAAc;;;;;;;0CAEtC,6LAAC;gCAAI,WAAU;0CACX,cAAA,6LAAC;oCACG,WAAU;oCACV,OAAO;wCAAE,OAAO,GAAG,qBAAqB,CAAC,CAAC;oCAAC;;;;;;;;;;;;;;;;;;;;;;;0BAK3D,6LAAC;gBAAI,WAAU;0BACV,SAAS,GAAG,CAAC,CAAA;oBACV,MAAM,WAAW,KAAK,GAAG,CAAC,AAAC,QAAQ,OAAO,GAAG,QAAQ,MAAM,GAAI,KAAK;oBACpE,qBACI,6LAAC;wBAEG,WAAW,CAAC,aAAa,EAAE,QAAQ,SAAS,GAAG,cAAc,IAAI;;0CAEjE,6LAAC;gCAAI,WAAU;;kDACX,6LAAC;wCAAI,WAAU;;4CACV,QAAQ,SAAS,kBAAI,6LAAC;gDAAK,WAAU;0DAAY;;;;;;4CACjD,QAAQ,KAAK;;;;;;;kDAElB,6LAAC;wCAAI,WAAU;kDAAuB,QAAQ,WAAW;;;;;;;;;;;;0CAE7D,6LAAC;gCAAI,WAAU;;kDACX,6LAAC;wCAAK,WAAU;;4CACX,QAAQ,OAAO,CAAC,OAAO,CAAC;4CAAG;4CAAI,QAAQ,MAAM;4CAAC;4CAAE,QAAQ,IAAI;;;;;;;kDAEjE,6LAAC;wCAAI,WAAU;kDACX,cAAA,6LAAC;4CACG,WAAU;4CACV,OAAO;gDAAE,OAAO,GAAG,SAAS,CAAC,CAAC;4CAAC;;;;;;;;;;;;;;;;;;uBAjBtC,QAAQ,EAAE;;;;;gBAuB3B;;;;;;;;;;;;AAIhB;KA1GM;uCA4GS","debugId":null}},
    {"offset": {"line": 1958, "column": 0}, "map": {"version":3,"sources":["file:///D:/my_projects/space-probe-game-next/src/components/ControlsHelp.tsx"],"sourcesContent":["import React from 'react';\n\nconst ControlsHelp: React.FC = () => {\n    return (\n        <div className=\"controls-help\">\n            <h3>操作方法</h3>\n            <div className=\"help-content\">\n                <p>← : 進行方向の左に推進</p>\n                <p>→ : 進行方向の右に推進</p>\n                <p>↑ : 進行方向に加速</p>\n                <p>↓ : 進行方向に減速（ブレーキ）</p>\n                <p>R : リスタート</p>\n                <p className=\"help-note\">\n                    ※矢印キーは常に探査機の速度方向を基準にします\n                </p>\n            </div>\n        </div>\n    );\n};\n\nexport default ControlsHelp;\n"],"names":[],"mappings":";;;;;;AAEA,MAAM,eAAyB;IAC3B,qBACI,6LAAC;QAAI,WAAU;;0BACX,6LAAC;0BAAG;;;;;;0BACJ,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;kCAAE;;;;;;kCACH,6LAAC;kCAAE;;;;;;kCACH,6LAAC;kCAAE;;;;;;kCACH,6LAAC;kCAAE;;;;;;kCACH,6LAAC;kCAAE;;;;;;kCACH,6LAAC;wBAAE,WAAU;kCAAY;;;;;;;;;;;;;;;;;;AAMzC;KAhBM;uCAkBS","debugId":null}},
    {"offset": {"line": 2045, "column": 0}, "map": {"version":3,"sources":["file:///D:/my_projects/space-probe-game-next/src/components/SettingsPanel.tsx"],"sourcesContent":["import React from 'react';\n\ninterface SettingsPanelProps {\n    probeSpeedMult: number;\n    setProbeSpeedMult: (v: number) => void;\n    gravityG: number;\n    setGravityG: (v: number) => void;\n    starMass: number;\n    setStarMass: (v: number) => void;\n}\n\nconst SettingsPanel: React.FC<SettingsPanelProps> = ({\n    probeSpeedMult,\n    setProbeSpeedMult,\n    gravityG,\n    setGravityG,\n    starMass,\n    setStarMass,\n}) => {\n    return (\n        <div className=\"settings-panel\">\n            <h3>シミュレーション設定</h3>\n            <div className=\"settings-content\">\n                <div className=\"setting-item\">\n                    <label>Probe speed multiplier: {probeSpeedMult.toFixed(2)}</label>\n                    <input\n                        type=\"range\"\n                        min=\"0.95\"\n                        max=\"1.50\"\n                        step=\"0.01\"\n                        value={probeSpeedMult}\n                        onChange={(e) => setProbeSpeedMult(Number(e.target.value))}\n                    />\n                </div>\n                <div className=\"setting-item\">\n                    <label>Gravity G: {gravityG.toFixed(3)}</label>\n                    <input\n                        type=\"range\"\n                        min=\"0.01\"\n                        max=\"1.0\"\n                        step=\"0.01\"\n                        value={gravityG}\n                        onChange={(e) => setGravityG(Number(e.target.value))}\n                    />\n                </div>\n                <div className=\"setting-item\">\n                    <label>Star mass: {Math.round(starMass).toLocaleString()}</label>\n                    <input\n                        type=\"range\"\n                        min=\"50000\"\n                        max=\"500000\"\n                        step=\"5000\"\n                        value={starMass}\n                        onChange={(e) => setStarMass(Number(e.target.value))}\n                    />\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default SettingsPanel;\n"],"names":[],"mappings":";;;;;;AAWA,MAAM,gBAA8C,CAAC,EACjD,cAAc,EACd,iBAAiB,EACjB,QAAQ,EACR,WAAW,EACX,QAAQ,EACR,WAAW,EACd;IACG,qBACI,6LAAC;QAAI,WAAU;;0BACX,6LAAC;0BAAG;;;;;;0BACJ,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;;oCAAM;oCAAyB,eAAe,OAAO,CAAC;;;;;;;0CACvD,6LAAC;gCACG,MAAK;gCACL,KAAI;gCACJ,KAAI;gCACJ,MAAK;gCACL,OAAO;gCACP,UAAU,CAAC,IAAM,kBAAkB,OAAO,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;kCAGhE,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;;oCAAM;oCAAY,SAAS,OAAO,CAAC;;;;;;;0CACpC,6LAAC;gCACG,MAAK;gCACL,KAAI;gCACJ,KAAI;gCACJ,MAAK;gCACL,OAAO;gCACP,UAAU,CAAC,IAAM,YAAY,OAAO,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;kCAG1D,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;;oCAAM;oCAAY,KAAK,KAAK,CAAC,UAAU,cAAc;;;;;;;0CACtD,6LAAC;gCACG,MAAK;gCACL,KAAI;gCACJ,KAAI;gCACJ,MAAK;gCACL,OAAO;gCACP,UAAU,CAAC,IAAM,YAAY,OAAO,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;;;;;;;;;;;;;AAM1E;KAhDM;uCAkDS","debugId":null}},
    {"offset": {"line": 2182, "column": 0}, "map": {"version":3,"sources":["file:///D:/my_projects/space-probe-game-next/src/components/HUD.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { DataPoint } from '../app/page';\nimport MiniChart from './MiniChart';\nimport MissionProgress from './MissionProgress';\nimport ControlsHelp from './ControlsHelp';\nimport SettingsPanel from './SettingsPanel';\n\ninterface HUDProps {\n    status?: string;\n    velocity?: number;\n    distance?: number;\n    fuel?: number;\n    slingshots?: number;\n    velocityHistory?: DataPoint[];\n    distanceHistory?: DataPoint[];\n    probeSpeedMult?: number;\n    setProbeSpeedMult?: (v: number) => void;\n    gravityG?: number;\n    setGravityG?: (v: number) => void;\n    starMass?: number;\n    setStarMass?: (v: number) => void;\n    gravityGridEnabled?: boolean;\n    setGravityGridEnabled?: (v: boolean) => void;\n}\n\nconst HUD: React.FC<HUDProps> = ({\n    status = 'Idle',\n    velocity = 0,\n    distance = 0,\n    fuel = 100,\n    slingshots = 0,\n    velocityHistory = [],\n    distanceHistory = [],\n    probeSpeedMult = 1.05,\n    setProbeSpeedMult = () => {},\n    gravityG = 0.133,\n    setGravityG = () => {},\n    starMass = 333000,\n    setStarMass = () => {},\n    gravityGridEnabled = false,\n    setGravityGridEnabled = () => {},\n}) => {\n    const [showCharts, setShowCharts] = useState(false);\n    const [showMissions, setShowMissions] = useState(false);\n    const [showHelp, setShowHelp] = useState(false);\n    const [showSettings, setShowSettings] = useState(false);\n\n    const handleChartsToggle = () => {\n        setShowCharts(!showCharts);\n        if (!showCharts) {\n            setShowMissions(false);\n            setShowHelp(false);\n            setShowSettings(false);\n        }\n    };\n\n    const handleMissionsToggle = () => {\n        setShowMissions(!showMissions);\n        if (!showMissions) {\n            setShowCharts(false);\n            setShowHelp(false);\n            setShowSettings(false);\n        }\n    };\n\n    const handleHelpToggle = () => {\n        setShowHelp(!showHelp);\n        if (!showHelp) {\n            setShowCharts(false);\n            setShowMissions(false);\n            setShowSettings(false);\n        }\n    };\n\n    const handleSettingsToggle = () => {\n        setShowSettings(!showSettings);\n        if (!showSettings) {\n            setShowCharts(false);\n            setShowMissions(false);\n            setShowHelp(false);\n        }\n    };\n\n    return (\n        <>\n            <div id=\"ui\" className=\"hud-container hud-compact\">\n                <div className=\"hud-compact-line\">\n                    <div className=\"hud-toggle-buttons\">\n                        <button\n                            className={`toggle-btn ${showCharts ? 'active' : ''}`}\n                            onClick={handleChartsToggle}\n                            title=\"グラフ表示の切り替え\"\n                        >\n                            グラフ\n                        </button>\n                        <button\n                            className={`toggle-btn ${showMissions ? 'active' : ''}`}\n                            onClick={handleMissionsToggle}\n                            title=\"ミッション進捗の切り替え\"\n                        >\n                            ミッション\n                        </button>\n                        <button\n                            className={`toggle-btn ${showHelp ? 'active' : ''}`}\n                            onClick={handleHelpToggle}\n                            title=\"操作方法の表示\"\n                        >\n                            操作方法\n                        </button>\n                        <button\n                            className={`toggle-btn ${showSettings ? 'active' : ''}`}\n                            onClick={handleSettingsToggle}\n                            title=\"シミュレーション設定\"\n                        >\n                            設定\n                        </button>\n                    </div>\n                    <label className=\"gravity-grid-checkbox\" title=\"重力井戸グリッド表示\">\n                        <input\n                            type=\"checkbox\"\n                            checked={gravityGridEnabled}\n                            onChange={(e) => setGravityGridEnabled(e.target.checked)}\n                        />\n                        <span>重力井戸</span>\n                    </label>\n                    <span className=\"stat-separator\">|</span>\n                    <span className=\"stat-item\">\n                        状態:\n                        <span className={`stat-value status-${status.toLowerCase().replace(' ', '-')}`}>\n                            {status}\n                        </span>\n                    </span>\n                    <span className=\"stat-separator\">,</span>\n                    <span className=\"stat-item\">\n                        速度:<span className=\"stat-value\">{velocity.toFixed(1)}</span>km/s\n                    </span>\n                    <span className=\"stat-separator\">,</span>\n                    <span className=\"stat-item\">\n                        距離:<span className=\"stat-value\">{distance.toFixed(2)}</span>AU\n                    </span>\n                    <span className=\"stat-separator\">,</span>\n                    <span className=\"stat-item\">\n                        燃料:\n                        <span className={`stat-value ${fuel < 20 ? 'low-fuel' : ''}`}>\n                            {fuel.toFixed(1)}\n                        </span>%\n                    </span>\n                    <span className=\"stat-separator\">,</span>\n                    <span className=\"stat-item\">\n                        スイングバイ:<span className=\"stat-value\">{slingshots}</span>回\n                    </span>\n                </div>\n            </div>\n\n            {showCharts && (\n                <div className=\"hud-charts-panel\">\n                    <MiniChart\n                        data={velocityHistory}\n                        color=\"#00ff88\"\n                        label=\"速度\"\n                        unit=\"km/s\"\n                    />\n                    <MiniChart\n                        data={distanceHistory}\n                        color=\"#00aaff\"\n                        label=\"距離\"\n                        unit=\"AU\"\n                    />\n                </div>\n            )}\n\n            {showMissions && (\n                <div className=\"hud-missions-panel\">\n                    <MissionProgress\n                        distance={distance}\n                        velocity={velocity}\n                        slingshots={slingshots}\n                        fuel={fuel}\n                    />\n                </div>\n            )}\n\n            {showHelp && (\n                <div className=\"hud-help-panel\">\n                    <ControlsHelp />\n                </div>\n            )}\n\n            {showSettings && (\n                <div className=\"hud-settings-panel\">\n                    <SettingsPanel\n                        probeSpeedMult={probeSpeedMult}\n                        setProbeSpeedMult={setProbeSpeedMult}\n                        gravityG={gravityG}\n                        setGravityG={setGravityG}\n                        starMass={starMass}\n                        setStarMass={setStarMass}\n                    />\n                </div>\n            )}\n        </>\n    );\n};\n\nexport default HUD;"],"names":[],"mappings":";;;;;AAAA;AAEA;AACA;AACA;AACA;;;;;;;;AAoBA,MAAM,MAA0B,CAAC,EAC7B,SAAS,MAAM,EACf,WAAW,CAAC,EACZ,WAAW,CAAC,EACZ,OAAO,GAAG,EACV,aAAa,CAAC,EACd,kBAAkB,EAAE,EACpB,kBAAkB,EAAE,EACpB,iBAAiB,IAAI,EACrB,oBAAoB,KAAO,CAAC,EAC5B,WAAW,KAAK,EAChB,cAAc,KAAO,CAAC,EACtB,WAAW,MAAM,EACjB,cAAc,KAAO,CAAC,EACtB,qBAAqB,KAAK,EAC1B,wBAAwB,KAAO,CAAC,EACnC;;IACG,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAC;IAC7C,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yKAAQ,EAAC;IACjD,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC;IACzC,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yKAAQ,EAAC;IAEjD,MAAM,qBAAqB;QACvB,cAAc,CAAC;QACf,IAAI,CAAC,YAAY;YACb,gBAAgB;YAChB,YAAY;YACZ,gBAAgB;QACpB;IACJ;IAEA,MAAM,uBAAuB;QACzB,gBAAgB,CAAC;QACjB,IAAI,CAAC,cAAc;YACf,cAAc;YACd,YAAY;YACZ,gBAAgB;QACpB;IACJ;IAEA,MAAM,mBAAmB;QACrB,YAAY,CAAC;QACb,IAAI,CAAC,UAAU;YACX,cAAc;YACd,gBAAgB;YAChB,gBAAgB;QACpB;IACJ;IAEA,MAAM,uBAAuB;QACzB,gBAAgB,CAAC;QACjB,IAAI,CAAC,cAAc;YACf,cAAc;YACd,gBAAgB;YAChB,YAAY;QAChB;IACJ;IAEA,qBACI;;0BACI,6LAAC;gBAAI,IAAG;gBAAK,WAAU;0BACnB,cAAA,6LAAC;oBAAI,WAAU;;sCACX,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;oCACG,WAAW,CAAC,WAAW,EAAE,aAAa,WAAW,IAAI;oCACrD,SAAS;oCACT,OAAM;8CACT;;;;;;8CAGD,6LAAC;oCACG,WAAW,CAAC,WAAW,EAAE,eAAe,WAAW,IAAI;oCACvD,SAAS;oCACT,OAAM;8CACT;;;;;;8CAGD,6LAAC;oCACG,WAAW,CAAC,WAAW,EAAE,WAAW,WAAW,IAAI;oCACnD,SAAS;oCACT,OAAM;8CACT;;;;;;8CAGD,6LAAC;oCACG,WAAW,CAAC,WAAW,EAAE,eAAe,WAAW,IAAI;oCACvD,SAAS;oCACT,OAAM;8CACT;;;;;;;;;;;;sCAIL,6LAAC;4BAAM,WAAU;4BAAwB,OAAM;;8CAC3C,6LAAC;oCACG,MAAK;oCACL,SAAS;oCACT,UAAU,CAAC,IAAM,sBAAsB,EAAE,MAAM,CAAC,OAAO;;;;;;8CAE3D,6LAAC;8CAAK;;;;;;;;;;;;sCAEV,6LAAC;4BAAK,WAAU;sCAAiB;;;;;;sCACjC,6LAAC;4BAAK,WAAU;;gCAAY;8CAExB,6LAAC;oCAAK,WAAW,CAAC,kBAAkB,EAAE,OAAO,WAAW,GAAG,OAAO,CAAC,KAAK,MAAM;8CACzE;;;;;;;;;;;;sCAGT,6LAAC;4BAAK,WAAU;sCAAiB;;;;;;sCACjC,6LAAC;4BAAK,WAAU;;gCAAY;8CACrB,6LAAC;oCAAK,WAAU;8CAAc,SAAS,OAAO,CAAC;;;;;;gCAAU;;;;;;;sCAEhE,6LAAC;4BAAK,WAAU;sCAAiB;;;;;;sCACjC,6LAAC;4BAAK,WAAU;;gCAAY;8CACrB,6LAAC;oCAAK,WAAU;8CAAc,SAAS,OAAO,CAAC;;;;;;gCAAU;;;;;;;sCAEhE,6LAAC;4BAAK,WAAU;sCAAiB;;;;;;sCACjC,6LAAC;4BAAK,WAAU;;gCAAY;8CAExB,6LAAC;oCAAK,WAAW,CAAC,WAAW,EAAE,OAAO,KAAK,aAAa,IAAI;8CACvD,KAAK,OAAO,CAAC;;;;;;gCACX;;;;;;;sCAEX,6LAAC;4BAAK,WAAU;sCAAiB;;;;;;sCACjC,6LAAC;4BAAK,WAAU;;gCAAY;8CACjB,6LAAC;oCAAK,WAAU;8CAAc;;;;;;gCAAkB;;;;;;;;;;;;;;;;;;YAKlE,4BACG,6LAAC;gBAAI,WAAU;;kCACX,6LAAC,6IAAS;wBACN,MAAM;wBACN,OAAM;wBACN,OAAM;wBACN,MAAK;;;;;;kCAET,6LAAC,6IAAS;wBACN,MAAM;wBACN,OAAM;wBACN,OAAM;wBACN,MAAK;;;;;;;;;;;;YAKhB,8BACG,6LAAC;gBAAI,WAAU;0BACX,cAAA,6LAAC,mJAAe;oBACZ,UAAU;oBACV,UAAU;oBACV,YAAY;oBACZ,MAAM;;;;;;;;;;;YAKjB,0BACG,6LAAC;gBAAI,WAAU;0BACX,cAAA,6LAAC,gJAAY;;;;;;;;;;YAIpB,8BACG,6LAAC;gBAAI,WAAU;0BACX,cAAA,6LAAC,iJAAa;oBACV,gBAAgB;oBAChB,mBAAmB;oBACnB,UAAU;oBACV,aAAa;oBACb,UAAU;oBACV,aAAa;;;;;;;;;;;;;AAMrC;GAjLM;KAAA;uCAmLS","debugId":null}},
    {"offset": {"line": 2557, "column": 0}, "map": {"version":3,"sources":["file:///D:/my_projects/space-probe-game-next/src/components/CameraControls.tsx"],"sourcesContent":["import React from 'react';\nimport { CameraView } from './Controls';\n\ninterface CameraControlsProps {\n    cameraView: CameraView;\n    setCameraView: (v: CameraView) => void;\n}\n\nconst CameraControls: React.FC<CameraControlsProps> = ({ cameraView, setCameraView }) => {\n    return (\n        <div className=\"camera-controls\">\n            <button\n                className={`camera-btn ${cameraView === 'free' ? 'active' : ''}`}\n                onClick={() => setCameraView('free')}\n                title=\"自由視点（マウス操作）\"\n            >\n                自由視点\n            </button>\n            <button\n                className={`camera-btn ${cameraView === 'top' ? 'active' : ''}`}\n                onClick={() => setCameraView('top')}\n                title=\"真上視点（太陽中心）\"\n            >\n                真上視点\n            </button>\n            <button\n                className={`camera-btn ${cameraView === 'probe' ? 'active' : ''}`}\n                onClick={() => setCameraView('probe')}\n                title=\"探査機追従視点\"\n            >\n                探査機追従\n            </button>\n        </div>\n    );\n};\n\nexport default CameraControls;\n"],"names":[],"mappings":";;;;;;AAQA,MAAM,iBAAgD,CAAC,EAAE,UAAU,EAAE,aAAa,EAAE;IAChF,qBACI,6LAAC;QAAI,WAAU;;0BACX,6LAAC;gBACG,WAAW,CAAC,WAAW,EAAE,eAAe,SAAS,WAAW,IAAI;gBAChE,SAAS,IAAM,cAAc;gBAC7B,OAAM;0BACT;;;;;;0BAGD,6LAAC;gBACG,WAAW,CAAC,WAAW,EAAE,eAAe,QAAQ,WAAW,IAAI;gBAC/D,SAAS,IAAM,cAAc;gBAC7B,OAAM;0BACT;;;;;;0BAGD,6LAAC;gBACG,WAAW,CAAC,WAAW,EAAE,eAAe,UAAU,WAAW,IAAI;gBACjE,SAAS,IAAM,cAAc;gBAC7B,OAAM;0BACT;;;;;;;;;;;;AAKb;KA1BM;uCA4BS","debugId":null}},
    {"offset": {"line": 2615, "column": 0}, "map": {"version":3,"sources":["file:///D:/my_projects/space-probe-game-next/src/app/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useCallback, useRef } from 'react';\nimport GameCanvas from '../components/GameCanvas';\nimport HUD from '../components/HUD';\nimport Controls, { CameraView } from '../components/Controls';\nimport CameraControls from '../components/CameraControls';\nimport { PHYSICS_SCALE } from '../lib/threeSetup';\n\nexport interface DataPoint {\n    time: number;\n    value: number;\n}\n\nconst Page = () => {\n    const [status, setStatus] = useState<string>('Idle');\n    const [velocity, setVelocity] = useState<number>(0);\n    const [distance, setDistance] = useState<number>(0);\n    const [fuel, setFuel] = useState<number>(100);\n    const [slingshots, setSlingshots] = useState<number>(0);\n\n    // 履歴データの保存（最大100ポイント）\n    const [velocityHistory, setVelocityHistory] = useState<DataPoint[]>([]);\n    const [distanceHistory, setDistanceHistory] = useState<DataPoint[]>([]);\n    const startTimeRef = useRef<number>(Date.now());\n\n    // simulation tuning parameters (editable via Controls)\n    const [probeSpeedMult, setProbeSpeedMult] = useState<number>(1.05);\n    const [gravityG, setGravityG] = useState<number>(PHYSICS_SCALE.G);\n    const [starMass, setStarMass] = useState<number>(PHYSICS_SCALE.SUN_MASS);\n    const [cameraView, setCameraView] = useState<CameraView>('free');\n    const [gravityGridEnabled, setGravityGridEnabled] = useState<boolean>(false);\n\n    // 履歴データ付きセッター\n    const setVelocityWithHistory = useCallback((value: number) => {\n        setVelocity(value);\n        const elapsed = (Date.now() - startTimeRef.current) / 1000; // 秒単位\n        setVelocityHistory(prev => {\n            const updated = [...prev, { time: elapsed, value }];\n            return updated.slice(-100); // 最大100ポイント\n        });\n    }, []);\n\n    const setDistanceWithHistory = useCallback((value: number) => {\n        setDistance(value);\n        const elapsed = (Date.now() - startTimeRef.current) / 1000;\n        setDistanceHistory(prev => {\n            const updated = [...prev, { time: elapsed, value }];\n            return updated.slice(-100);\n        });\n    }, []);\n\n    // stable setters object to pass down (memoized so reference is stable)\n    const hudSetters = React.useMemo(\n        () => ({\n            setStatus,\n            setVelocity: setVelocityWithHistory,\n            setDistance: setDistanceWithHistory,\n            setFuel,\n            setSlingshots\n        }),\n        [setStatus, setVelocityWithHistory, setDistanceWithHistory, setFuel, setSlingshots]\n    );\n\n    return (\n        <div>\n            <GameCanvas hudSetters={hudSetters} probeSpeedMult={probeSpeedMult} gravityG={gravityG} starMass={starMass} cameraView={cameraView} gravityGridEnabled={gravityGridEnabled} />\n            <HUD\n                status={status}\n                velocity={velocity}\n                distance={distance}\n                fuel={fuel}\n                slingshots={slingshots}\n                velocityHistory={velocityHistory}\n                distanceHistory={distanceHistory}\n                probeSpeedMult={probeSpeedMult}\n                setProbeSpeedMult={setProbeSpeedMult}\n                gravityG={gravityG}\n                setGravityG={setGravityG}\n                starMass={starMass}\n                setStarMass={setStarMass}\n                gravityGridEnabled={gravityGridEnabled}\n                setGravityGridEnabled={setGravityGridEnabled}\n            />\n            <CameraControls cameraView={cameraView} setCameraView={setCameraView} />\n        </div>\n    );\n};\n\nexport default Page;"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAEA;AACA;;;AAPA;;;;;;AAcA,MAAM,OAAO;;IACT,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAS;IAC7C,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAS;IACjD,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAS;IACjD,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAS;IACzC,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAS;IAErD,sBAAsB;IACtB,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,yKAAQ,EAAc,EAAE;IACtE,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,yKAAQ,EAAc,EAAE;IACtE,MAAM,eAAe,IAAA,uKAAM,EAAS,KAAK,GAAG;IAE5C,uDAAuD;IACvD,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,yKAAQ,EAAS;IAC7D,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAS,4IAAa,CAAC,CAAC;IAChE,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAS,4IAAa,CAAC,QAAQ;IACvE,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAa;IACzD,MAAM,CAAC,oBAAoB,sBAAsB,GAAG,IAAA,yKAAQ,EAAU;IAEtE,cAAc;IACd,MAAM,yBAAyB,IAAA,4KAAW;oDAAC,CAAC;YACxC,YAAY;YACZ,MAAM,UAAU,CAAC,KAAK,GAAG,KAAK,aAAa,OAAO,IAAI,MAAM,MAAM;YAClE;4DAAmB,CAAA;oBACf,MAAM,UAAU;2BAAI;wBAAM;4BAAE,MAAM;4BAAS;wBAAM;qBAAE;oBACnD,OAAO,QAAQ,KAAK,CAAC,CAAC,MAAM,YAAY;gBAC5C;;QACJ;mDAAG,EAAE;IAEL,MAAM,yBAAyB,IAAA,4KAAW;oDAAC,CAAC;YACxC,YAAY;YACZ,MAAM,UAAU,CAAC,KAAK,GAAG,KAAK,aAAa,OAAO,IAAI;YACtD;4DAAmB,CAAA;oBACf,MAAM,UAAU;2BAAI;wBAAM;4BAAE,MAAM;4BAAS;wBAAM;qBAAE;oBACnD,OAAO,QAAQ,KAAK,CAAC,CAAC;gBAC1B;;QACJ;mDAAG,EAAE;IAEL,uEAAuE;IACvE,MAAM,aAAa,wKAAK,CAAC,OAAO;oCAC5B,IAAM,CAAC;gBACH;gBACA,aAAa;gBACb,aAAa;gBACb;gBACA;YACJ,CAAC;mCACD;QAAC;QAAW;QAAwB;QAAwB;QAAS;KAAc;IAGvF,qBACI,6LAAC;;0BACG,6LAAC,8IAAU;gBAAC,YAAY;gBAAY,gBAAgB;gBAAgB,UAAU;gBAAU,UAAU;gBAAU,YAAY;gBAAY,oBAAoB;;;;;;0BACxJ,6LAAC,uIAAG;gBACA,QAAQ;gBACR,UAAU;gBACV,UAAU;gBACV,MAAM;gBACN,YAAY;gBACZ,iBAAiB;gBACjB,iBAAiB;gBACjB,gBAAgB;gBAChB,mBAAmB;gBACnB,UAAU;gBACV,aAAa;gBACb,UAAU;gBACV,aAAa;gBACb,oBAAoB;gBACpB,uBAAuB;;;;;;0BAE3B,6LAAC,kJAAc;gBAAC,YAAY;gBAAY,eAAe;;;;;;;;;;;;AAGnE;GAzEM;KAAA;uCA2ES","debugId":null}}]
}